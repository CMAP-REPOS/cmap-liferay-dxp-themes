"use strict";angular.module("cmapMobilityApp",["ngAnimate","ngTouch","ui.router","ngSanitize","cmapMobilityFilters"]).config(["$stateProvider","$urlRouterProvider",function(t,n){var e=1e3;t.state("splash",{url:"/",controller:"SplashCtrl",templateUrl:"app/splash/splash.tpl.html",resolve:{copydata:["$q","$http","sharedDataFactory","sharedCopyDataService",function(t,n,e,i){var a=t.defer();return e.setData().then(function(t){var n=i.setCopy("splash",t);a.resolve(n)}),a.promise}],mapRoutePromise:["$q","$timeout","$stateParams","dataCollection",function(t,n,e,i){var a=t.defer(),r=i.load("home");return t.all(r.waitFor).then(function(){return a.resolve(r)}),a.promise}],delay:["$q","$timeout",function(t,n){var i=t.defer();return n(function(){i.resolve("delay")},1.5*e),i.promise}]}}).state("introduction",{url:"/introduction/:stepId",controller:"IntroductionCtrl",templateUrl:"app/introduction/introduction.tpl.html",resolve:{copydata:["$q","sharedDataFactory","sharedCopyDataService","$stateParams",function(t,n,e,i){var a=t.defer();return n.setData().then(function(t){var n=e.setCopy(i,t);return a.resolve(n)}),a.promise}]}}).state("topic",{url:"/topic/:topicId",controller:"IndicatorCtrl",templateUrl:"app/indicator/topic.tpl.html",resolve:{copydata:["$q","sharedDataFactory","sharedCopyDataService","$stateParams",function(t,n,e,i){var a=t.defer();return n.setData().then(function(t){var n=e.setCopy(i,t);return a.resolve(n)}),a.promise}],delay:["$q","$timeout",function(t,n){var i=t.defer();return n(function(){i.resolve("delay")},.5*e),i.promise}]}}).state("topic.indicator",{url:"/:indicatorId",controller:"IndicatorCtrl",templateUrl:"app/indicator/topic.indicator.tpl.html",resolve:{mapRoutePromise:["$q","$stateParams","dataCollection",function(t,n,e){var i=t.defer(),a=e.load(n.indicatorId);return t.all(a.waitFor).then(function(){return i.resolve(a)}),i.promise}],delay:["$q","$timeout","$state",function(t,n,i){var a=t.defer();return"topic"===i.current.name?n(function(){a.resolve("delay")},e+e):a.resolve("delay"),a.promise}]}}),n.otherwise("/")}]),angular.module("cmapMobilityApp").run(["$templateCache",function(t){t.put("app/indicator/topic.indicator.tpl.html",'<div ng-if="loaded" class="indicator">\n	<intro></intro>\n\n	<div shadow="0"></div>\n\n	<!-- map: congestion [3D] -->\n	<div ng-if="state.topicId == \'roads\' && state.indicatorId == \'congestion\'">\n		<map-congestion ng-if="!hideCongestion && webGL" inview="toggleRender"></map-congestion>\n		<map-congestion-fallback ng-if="!webGL || hideCongestion"></map-congestion-fallback>\n	</div>\n\n	<!-- map: ridership -->\n	<div ng-if="state.topicId == \'transit\' && state.indicatorId == \'ridership\'">\n		<ridership></ridership>\n	</div>\n\n	<!-- map: access to transit -->\n	<div ng-if="state.topicId == \'transit\' && state.indicatorId == \'access-to-transit\'">\n		<map-access-to-transit></map-access-to-transit>\n	</div>\n\n	<!-- map: crossing delay -->\n	<div ng-if="state.topicId == \'freight\' && state.indicatorId == \'crossing-delay\'">\n		<crossingdelay></crossingdelay>\n	</div>\n\n	<!-- map: bridge quality -->\n	<div ng-if="state.topicId == \'roads\' && state.indicatorId == \'bridge-condition\'">\n		<bridge-condition></bridge-condition>\n	</div>\n\n	<!-- map: create project -->\n	<div ng-if="state.topicId == \'freight\' && state.indicatorId == \'create-projects\'">\n		<createprojects></createprojects>\n	</div>\n\n	<!-- map: ridequality -->\n	<div ng-if="state.topicId == \'roads\' && state.indicatorId == \'ride-quality\'">\n		<ridequality></ridequality>\n	</div>\n\n	<div shadow="1" ng-if="state.topicId != \'forward\'"></div>\n\n	<section\n		class="section section--bg-video"\n		ng-if="state.topicId != \'forward\'">\n\n		<video-loader\n			src="{{copy.content.video.src}}"\n			loop\n			poster="{{copy.content.poster}}"\n			class="section__video"\n			inview="togglePlay"\n		></video-loader>\n\n		<div class="container-wrapper container-wrapper--full-width">\n			<h4\n				class="bar-heading bar-heading--inline-block bar-heading--inverse"\n				ng-bind="copy.content.video.title">\n			</h4>\n\n			<div class="section__description section__description--inverse">\n\n				<p class="text-lead text-lead--{{state.indicatorId}}" ng-bind-html="copy.content.video.description"></p>\n\n				<div class="overlay__congestion" ng-if="copy.content.video.column && state.indicatorId == \'congestion\'">\n\n					<div ng-repeat="row in copy.content.video.column" class="columns columns--two">\n						<div\n							ng-repeat="col in row"\n							class="columns__column"\n							ng-class="{\'columns__column--first\': $first}">\n\n							<span ng-bind="col"></span>\n						</div>\n					</div>\n\n				</div>\n\n				<div class="ride-quality" ng-if="copy.content.video.column && state.indicatorId == \'ride-quality\'">\n\n					<div\n						ng-repeat="row in copy.content.video.column"\n						class="columns columns--two"\n						ng-class="{\'columns--bordered\': $last}">\n						<div\n							ng-repeat="col in row"\n							class="columns__column"\n							ng-class="{\'columns__column--first\': $first}">\n\n							<p class="text-lead" ng-bind-html="col"></p>\n						</div>\n					</div>\n\n				</div>\n\n				<div class="overlay__maintenance" ng-if="copy.content.video.column && state.indicatorId == \'maintenance\'">\n\n					<div ng-repeat="row in copy.content.video.column" class="columns columns--two">\n						<div class="columns__column">\n							<span ng-bind-html="row"></span>\n						</div>\n					</div>\n\n				</div>\n\n			</div>\n		</div>\n\n	</section>\n\n	<div shadow="2" ng-if="state.topicId != \'forward\'"></div>\n\n	<section\n		class="section section--centered section--bg-image"\n		ng-if="state.topicId == \'forward\'"\n		ng-style="{\'background-image\': \'url({{ copy.content.image }})\'}">\n	</section>\n\n	<indicator-graph ng-if="state.topicId != \'forward\'"></indicator-graph>\n\n</div>\n\n<footer></footer>\n'),t.put("app/indicator/topic.tpl.html",'<div ui-view>\n	<!-- default view of indicator -->\n	<full-page-image image="copy.content.image"></full-page-image>\n</div>\n'),t.put("app/introduction/introduction.tpl.html",'<section class="introduction">\n\n	<full-page-image\n		image="copy.content.image"\n		title="copy.content.title"\n		description="copy.content.description">\n	</full-page-image>\n\n	<navigation-arrow class="navigation-arrow--white"></navigation-arrow>\n\n</section>\n'),t.put("app/splash/splash.tpl.html",'<section class="splash">\n\n	<navigation-arrow-splash></navigation-arrow-splash>\n\n	<map-landing-page ng-if="webGL && loaded"></map-landing-page>\n	<fallback src="data/fallbacks/landing-page/fallback" ng-if="!webGL && loaded"></fallback>\n\n	<div class="heading">\n\n		<h1 class="page_title" ng-bind-html="copy.content.title"></h1>\n		<p class="text-lead" ng-repeat="text in copy.content.description" ng-bind-html="text"></p>\n\n	</div>\n\n	<figure ng-if="!webGL && loaded">\n		<figcaption class="keystat keystat--rails">\n			<h5 class="keystat__title">Rail</h5>\n			<div class="text-color-primary-sky keystat__value-container">\n				<span class="keystat__value">3,865</span>\n				<span class="keystat__metric">miles</span>\n			</div>\n		</figcaption>\n		<figcaption class="keystat keystat--roads">\n			<h5 class="keystat__title">Road</h5>\n			<div class="text-color-quaternary keystat__value-container">\n				<span class="keystat__value">29,989</span>\n				<span class="keystat__metric">miles</span>\n			</div>\n		</figcaption>\n	</figure>\n\n</section>\n'),t.put("components/directive/directive.tpl.html",'<div class="drctv"></div>\n'),t.put("components/fallback/fallback.tpl.html",'<!-- autoplay -->\n<video-loader\n	src="{{src}}"\n	autoplay loop\n	poster="{{img}}"\n	ng-if="!overlay"\n></video-loader>\n\n<!-- not autoplay & no loop -->\n<video-loader\n	src="{{src}}"\n	poster="{{img}}"\n	ng-if="overlay"\n></video-loader>\n\n<div class="overlay" ng-show="showOverlay"></div>\n\n<div class="overlay__modal notification ng-scope" ng-show="showOverlay" ng-click="play()">\n\n	<div class="overlay__text">\n		The interactive version of the 3D map is not available. <br>\n		Click the play button below to see a highlight video.\n	</div>\n\n	<div class="overlay__play">\n\n		<div class="play-btn" ng-click="play()"></div> play highlight video\n\n	</div>\n\n</div>\n'),t.put("components/footer/footer.tpl.html",'<section\n	class="section footer"\n	role="contentinfo">\n	<div class="container-wrapper">\n\n		<div class="footer-menu">\n\n			<a\n				href="http://www.cmap.illinois.gov/"\n				class="logo-cmap">\n				CMAP\n				<img src="images/cmap-logo.svg" alt="Logo CMAP">\n			</a>\n\n			<a target="_blank" href="http://www.cmap.illinois.gov/mobility/explore/sources/" class="footer-menu__item footer-menu__item__link">\n				Sources\n			</a>\n\n			<a target="_blank" href="http://www.cmap.illinois.gov/2040/" class="footer-menu__item footer-menu__item__link">\n				GO TO 2040\n			</a>\n\n			<a target="_blank" href="http://www.fund2040.org/" class="footer-menu__item footer-menu__item__link">\n				FUND 2040\n			</a>\n\n			<a target="_blank" href="http://www.cmap.illinois.gov/contact-us/" class="footer-menu__item footer-menu__item__link">\n				Contact\n			</a>\n		</div>\n\n		<p class="copyright">\n			<span class="copyright__item"><span class="copyright__item__date">© 2014</span> Chicago Metropolitan Agency for Planning</span>\n\n			<span ng-click="openNotification()" class="copyright__credits">credits</span>\n		</p>\n	</div>\n</section>\n'),t.put("components/full-page-image/full-page-image.tpl.html",'<section class="full-page-image">\n	<div class="full-page-image__background-image"\n		ng-class="cssClass"\n		ng-style="{\'background-image\': \'url(\'+ image +\')\'}">\n	</div>\n\n	<div class="full-page-image__overlay"></div>\n\n	<div class="full-page-image__wrapper" ng-if="title || description">\n		<h1 class="full-page-image__title bar-heading text-jumbo" ng-bind="title"></h1>\n		<div class="full-page-image__description" ng-repeat="text in description">\n			<p class="full-page-image__description__paragraph text-lead" ng-bind="text"></p>\n		</div>\n	</div>\n</section>\n'),t.put("components/indicator-graph/indicator-graph.tpl.html",'<section class="indicator-graph section section--white">\n\n	<div class="container-wrapper container-wrapper--full-width">\n		<div class="sectioncopy-intro">\n			<h4 class="bar-heading bar-heading--inline-block"><span class="text-uppercase">Indicator:</span> <span ng-bind-html="indicatorData.title"></span></h4>\n		</div>\n\n		<div class="indicator-graph__wrapper">\n			<p ng-if="indicatorData.explanation" class="text-lead" ng-bind-html="indicatorData.explanation"></p>\n		</div>\n	</div>\n\n	<div class="graph-container">\n		<!-- donut charts -->\n		<div ng-if="indicatorData.type==\'pieChart\'" class="graph-donut" ng-class="{\'graph-donut__large\': indicatorData.pieType == \'large\'}">\n\n			<div ng-repeat="graph in indicatorData.data" class="graph-donut__wrapper">\n\n				<div ng-if="indicatorData.pieType==\'large\'">\n\n					<div class="graph-donut__large__heading">\n						{{graph.label}}\n					</div>\n					<div class="graph-donut__large__subtext">\n						{{graph.subtext}}\n					</div>\n\n				</div>\n\n				<graph-donut\n					label="{{graph.label}}"\n					value="{{graph.value}}"\n					range="{{graph.range}}"\n					metric="{{graph.metric}}"\n					ring="7"\n					width="{{indicatorData.width}}"\n					type="{{indicatorData.pieType}}"\n					inview="intro"\n				></graph>\n\n			</div>\n\n			<div class="graph-donut__extra-txt" ng-if="indicatorData.extra">\n				{{indicatorData.extra}}\n			</div>\n\n		</div>\n\n		<!-- horizontalBarChart charts -->\n		<div ng-if="indicatorData.type==\'horizontalBarChart\'" class="graph-horizontal-bar">\n\n			<div ng-repeat="graph in indicatorData.data" class="graph-horizontal-bar__wrapper">\n				<graph-horizontal-bar\n					label="{{graph.label}}"\n					value="{{graph.value}}"\n					inview="intro"\n				></graph-horizontal-bar>\n			</div>\n\n		</div>\n\n		<!-- verticslBarChart charts -->\n		<div ng-if="indicatorData.type==\'verticalBarChart\'" class="graph-vertical-bar">\n\n			<graph-vertical-bar inview="intro"></graph-vertical-bar>\n\n		</div>\n\n		<!-- stackedBarChart charts -->\n		<div ng-if="indicatorData.type==\'stackedBarChart\'" class="graph-stacked-bar">\n\n			<div ng-repeat="graph in indicatorData.data" class="graph-stacked-bar__wrapper">\n				<graph-stacked-bar\n					label="{{graph.label}}"\n					value="{{graph.value | number:2}}"\n					max="{{indicatorData.max}}"\n					units="{{indicatorData.units}}"\n					inview="intro"\n				></graph-stacked-bar>\n\n			</div>\n\n		</div>\n\n		<!-- linechart -->\n		<div ng-if="indicatorData.type==\'lineChart\'" class="graph-line" ng-class="{\'dual-line\': indicatorData.points2, \'single-line\': !indicatorData.points2}">\n\n			<graph-line width="{{indicatorData.width}}" height="300" split="{{indicatorData.split}}" inview="intro"></graph-line>\n\n		</div>\n\n		<!-- timeline -->\n		<div ng-if="indicatorData.type==\'timeline\'" class="graph-timeline">\n\n			<graph-timeline inview="intro"></graph-timeline>\n\n		</div>\n\n		<!-- images (as temp. fallback) -->\n		<div\n			ng-if="indicatorData.type==\'image\'"\n			class="graph-image"\n		>\n			<img ng-src="{{indicatorData.src}}">\n\n		</div>\n	</div>\n\n</section>\n'),t.put("components/intro/intro.tpl.html",'<section class="section section--white intro" ng-if="state.topicId !== \'forward\'">\n	<div class="intro__wrapper">\n		<h1 ng-bind="copy.content.title"></h1>\n		<p class="text-lead" ng-repeat="text in copy.content.description" ng-bind-html="text"></p>\n		<navigation-arrow></navigation-arrow>\n	</div>\n</section>\n\n<section class="section section--white intro intro--expanded" ng-if="state.topicId === \'forward\'">\n	<div class="intro__wrapper">\n		<h1 ng-bind="copy.content.title"></h1>\n		<navigation-arrow></navigation-arrow>\n	</div>\n	<div class="intro__wrapper">\n		<div>\n			<p ng-bind-html="copy.content.description"></p>\n		</div>\n	</div>\n</section>\n'),t.put("components/loader/loader.tpl.html","<!-- loader: todo -->\n"),t.put("components/navigation/navigation.tpl.html",'<nav role="navigation" class="navigation" ng-class="[getNavState(), getNavTheme()]">\n	<div class="navigation__wrapper">\n\n		<div class="container-wrapper">\n			<div class="navigation__intro" ng-if="currentState === \'topic\'">\n				<div\n					class="navigation__intro__title-wrapper"\n					ng-repeat="title in copy.content.title">\n					<h1\n						class="navigation__intro__title bar-heading"\n						ng-bind="title">\n					</h1>\n				</div>\n				<p\n					class="text-lead"\n					ng-repeat="paragraph in copy.content.description"\n					ng-bind="paragraph">\n				</p>\n			</div>\n		</div>\n\n		<a\n			ng-if="currentState === \'splash\'"\n			href="http://www.cmap.illinois.gov/"\n			class="logo-cmap">\n			CMAP\n			<img src="images/cmap-logo.svg" alt="Logo CMAP">\n		</a>\n\n		<!-- next/previous -->\n		<navigation-arrow ng-if="data" update class="navigation-arrow--dark"></navigation-arrow>\n\n		<!-- navigation -->\n		<div class="navigation-menu">\n			<!-- introduction -->\n			<ul class="navigation-menu__wrapper">\n\n				<li ng-repeat="nav in data.introduction"\n					ng-class="getMenuTheme(\'introduction\')">\n					<a\n						ui-sref="splash"\n						class="navigation-menu__item navigation-menu__item--is-followed"\n						ng-class="{\n							\'navigation-menu__item--visited\': isVisited(\'splash\'),\n							\'navigation-menu__item--active\': isActive == \'splash\'\n						}">\n\n						<svg class="navigation-menu__item__indicator">\n							<circle cx="10" cy="10" r="2"\n								class="navigation-menu__item__indicator__dot">\n							</circle>\n							<circle cx="10" cy="10" r="9"\n								class="navigation-menu__item__indicator__base">\n							</circle>\n						</svg>\n						<div class="navigation-menu__item__ripple"></div>\n\n						<div class="navigation-menu__item__name" ng-bind="nav.navName"></div>\n					</a>\n\n					<ul class="navigation-menu__subnav"\n						ng-class="getMenuState(\'introduction\')">\n						<li ng-repeat="subnav in nav.introduction">\n\n							<a\n								ui-sref="introduction({ stepId: subnav.url })"\n								class="navigation-menu__item"\n								ng-class="{\n									\'navigation-menu__item--is-followed\': activeIndex >= $index,\n									\'navigation-menu__item--visited\': isVisited(subnav.url),\n									\'navigation-menu__item--active\': isActive == subnav.url\n								}">\n\n								<svg class="navigation-menu__item__indicator">\n									<circle cx="10" cy="10" r="2"\n										class="navigation-menu__item__indicator__dot">\n									</circle>\n									<circle cx="10" cy="10" r="9"\n										class="navigation-menu__item__indicator__base">\n									</circle>\n								</svg>\n								<div class="navigation-menu__item__ripple"></div>\n\n								<div class="navigation-menu__item__name" ng-bind="subnav.navName"></div>\n							</a>\n						</li>\n					</ul>\n				</li>\n\n			</ul>\n\n			<!-- topic -->\n			<ul class="navigation-menu__wrapper">\n\n				<li ng-repeat="nav in data.topic"\n					ng-class="getMenuTheme(nav.url)">\n\n					<span class="navigation-menu__divider navigation-menu__divider--rotated">\n						<img src="styles/images/navigation/nav-arrow.svg">\n					</span>\n\n					<a\n						ui-sref="topic({ topicId: nav.url })"\n						class="navigation-menu__item"\n						ng-class="{\n							\'navigation-menu__item--visited\': isVisited(nav.url),\n							\'navigation-menu__item--active\': isActive == nav.url\n						}">\n\n						<svg class="navigation-menu__item__indicator">\n							<circle cx="10" cy="10" r="2"\n								class="navigation-menu__item__indicator__dot">\n							</circle>\n							<circle cx="10" cy="10" r="9"\n								class="navigation-menu__item__indicator__base">\n							</circle>\n						</svg>\n						<div class="navigation-menu__item__ripple"></div>\n\n						<div class="navigation-menu__item__name" ng-bind="nav.navName"></div>\n					</a>\n\n					<ul class="navigation-menu__subnav"\n						ng-class="getMenuState(nav.url)">\n						<li ng-repeat="subnav in nav.indicators">\n							<a\n								ui-sref="topic.indicator({ topicId: nav.url, indicatorId: subnav.url })"\n								class="navigation-menu__item"\n								ng-class="{\n									\'navigation-menu__item--visited\': isVisited(subnav.url),\n									\'navigation-menu__item--active\': isActive == subnav.url\n								}">\n\n								<svg class="navigation-menu__item__indicator">\n									<circle cx="10" cy="10" r="2"\n								class="navigation-menu__item__indicator__dot">\n							</circle>\n									<circle cx="10" cy="10" r="9"\n										class="navigation-menu__item__indicator__base">\n									</circle>\n								</svg>\n								<div class="navigation-menu__item__ripple"></div>\n\n								<div class="navigation-menu__item__name" ng-bind="subnav.navName"></div>\n							</a>\n						</li>\n					</ul>\n				</li>\n\n			</ul>\n		</div>\n</nav>\n'),t.put("components/navigation-arrow/navigation-arrow.tpl.html",'<div ng-click="navigate(\'previous\')" class="navigation-arrow navigation-arrow--previous">\n	<div class="navigation-arrow__circle">\n		<svg class="navigation-arrow__arrow" width="13" height="15">\n			<polyline fill="none" stroke="#2b3741" stroke-miterlimit="10" points="12.167,15.05 0.278,7.372 12.167,0.416 "/></svg>\n		</svg>\n	</div>\n\n	<div class="navigation-arrow__next-page">\n		{{previous.navName}}\n	</div>\n</div>\n\n\n<div ng-if="!last" ng-click="navigate(\'next\')" class="navigation-arrow navigation-arrow--next">\n	<div class="navigation-arrow__circle">\n		<svg class="navigation-arrow__arrow" width="13" height="15">\n			<polyline fill="none" stroke="#2b3741" stroke-miterlimit="10" points="0.278,0.416 12.167,7.372 0.278,15.05 "/></svg>\n		</svg>\n	</div>\n\n	<div class="navigation-arrow__next-page">\n		{{next.navName}}\n	</div>\n</div>\n'),t.put("components/navigation-arrow-splash/navigation-arrow-splash.tpl.html",'<a\n	class="navigation-arrow-splash"\n	ng-if="render.done"\n	ui-sref="introduction({stepId: \'prioritizing-the-future\'})">\n\n	<div class="navigation-arrow-splash__circle">\n		<div class="navigation-arrow-splash__dot"></div>\n	</div>\n\n	<span class="navigation-arrow-splash__label">\n		Start to explore\n	</span>\n</a>\n'),t.put("components/notification/notification.tpl.html",'<div class="notification__overlay" ng-if="isVisible" ng-click="dismiss()"></div>\n\n<div class="notification" ng-if="isVisible === \'warn\'">\n	<div class="notification__text">\n		<img class="notification__icon" src="images/icons/notification-icon.svg" width="20" height="20" alt="">\n		<h3>Important notice</h3>\n		Your browser and/or device are not optimal for viewing this website. Features of this websites may not be displayed correctly and consistently.\n		<h3>What does it mean?</h3>\n		If you are using an older computer or tablet; the pages may load very slow and have problems when you are browsing or interacting with the pages.\n		On some browsers the 3D maps cannot be shown. We have non-interactive video’s instead for the landing page and the page about congestion.\n		<h3>What can I do?</h3>\n		We recommend using the latest versions of Chrome or Firefox, and preferably visit the website on a larger display and recent computer. Some of the maps are difficult to view on a small screen with lower resolution.\n		We are sorry for the inconvenience, and hope you enjoy the website nonetheless!\n		<div>\n			<button class="button button--normal button--active button--outline" ng-click="dismiss()">Close this message</button>\n		</div>\n	</div>\n	<span class="notification__close" ng-click="dismiss()"></span>\n</div>\n\n<div class="notification" ng-if="isVisible === \'credits\'">\n	<div class="notification__text">\n		<h3>Credits</h3>\n		<p>Concept, design & development by <a href="http://www.cleverfranke.com/" target="_blank">CLEVER°FRANKE</a></p>\n		<p>Time lapse videos by <a href="http://www.hedrichblessing.com/daveportfolio1.html" target="_blank">Dave Burk | Hedrich Blessing</a></p>\n		<p>Photography by <a href="http://www.terryevansphotography.com/" target="_blank">Terry Evans</a></p>\n		<div>\n			<button class="button button--normal button--active button--outline" ng-click="dismiss()">Close this message</button>\n		</div>\n	</div>\n	<span class="notification__close" ng-click="dismiss()"></span>\n</div>\n'),t.put("components/popover/popover.tpl.html",'<div\n	ng-if="contentText"\n	class="popover"\n	ng-class="{\'popover--expanded\': expanded}">\n	<div\n		ng-click="expanded = !expanded"\n		class="popover__btn">\n\n		<span class="popover__icon">\n			<img src="images/icons/questionmark.svg" alt="">\n		</span>\n		<div class="popover__title">\n			About this map\n			<svg\n				class="popover__close"\n				ng-show="expanded"\n				version="1.1"\n				xmlns="http://www.w3.org/2000/svg"\n				xmlns:xlink="http://www.w3.org/1999/xlink"\n				x="0px"\n				y="0px"\n				width="22px"\n				height="22px"\n				viewBox="0 0 22 22"\n				xml:space="preserve">\n				<circle class="popover__close__circle" fill="none" stroke="#000" stroke-miterlimit="10" cx="10.5" cy="10.5" r="10"/>\n				<line class="popover__close__line" fill="none" stroke="#000" stroke-miterlimit="10" x1="5.04" y1="9.81" x2="16.04" y2="9.81"/>\n			</svg>\n		</div>\n	</div>\n\n	<div\n		ng-show="expanded"\n		class="popover__content">\n		<p>\n			<em ng-bind="contentText.mapSubtitle"></em>\n		</p>\n		<p ng-if="contentText.mapLegendImage">\n			<img ng-src="{{ contentText.mapLegendImage }}" alt="">\n		</p>\n	</div>\n</div>\n'),t.put("components/spinner/spinner.tpl.html",'<div class="image">\n	<i></i>\n	<i></i>\n	<i></i>\n</div>\n'),t.put("components/timeline/timeline.tpl.html",'<div class="play">\n\n	<span>time</span>\n	<div class="play-btn" ng-if="!play" ng-click="togglePlay(true)"></div>\n	<div class="pause-btn" ng-if="play" ng-click="togglePlay(false)"></div>\n\n</div>\n\n<svg>\n\n	<g class="ticks">\n		<line class="before-line" y1="47" y2="47" x1="0" x2="100"/>\n		<line class="after-line" y1="47" y2="47" x1="0" x2="100"/>\n	</g>\n\n	<g class="value">\n		<rect x="0" y="0" width="80" height="25" filter="url(#highlight-drop-shadow-congestion)"  />\n		<g class="triangle-group" transform="translate(36, 25)">\n			<polyline points="8.142,0 4.07,7.07 0,0 "/>\n		</g>\n		<line x1="40" x2="40" y1="0" y2="47" />\n		<text x="40" y="17">12:00am</text>\n	</g>\n\n	<rect class="hitbox" y="35" x="0" width="100%" height="25"/>\n\n	<g class="scrubber-group">\n		<g class="scrubber-center" transform="translate(-5.5,0)">\n			<circle cx="20.5" cy="20.5" r="10" filter="url(#highlight-drop-shadow-congestion)" />\n			<line x1="20.168" y1="24.289" x2="20.168" y2="17.289"/>\n			<line x1="17.168" y1="24.289" x2="17.168" y2="17.289"/>\n			<line x1="23.168" y1="24.289" x2="23.168" y2="17.289"/>\n		</g>\n	</g>\n\n	<defs>\n		<filter id="highlight-drop-shadow-congestion" height="130%">\n			<feGaussianBlur in="SourceAlpha" stdDeviation="2" result="blur"></feGaussianBlur>\n			<feOffset in="blur" dx="1" dy="1" result="offsetBlur"></feOffset>\n			<feFlood in="offsetBlur" flood-color="#000000" flood-opacity="0.25" result="offsetColor"></feFlood>\n			<feComposite in="offsetColor" in2="offsetBlur" operator="in" result="offsetBlur"></feComposite>\n			<feMerge>\n				<feMergeNode in="offsetBlur"></feMergeNode>\n				<feMergeNode in="SourceGraphic"></feMergeNode>\n			</feMerge>\n		</filter>\n	</defs>\n\n</svg>\n'),t.put("components/video-loader/video-loader.tpl.html",'<div class="fallback-image" ng-style="{\'background-image\': image}" ng-if="!isPlaying"></div>\n'),t.put("components/graphs/graph-donut/graph-donut.tpl.html",""),t.put("components/graphs/graph-horizontal-bar/graph-horizontal-bar.tpl.html",""),t.put("components/graphs/graph-line/graph-line.tpl.html",""),t.put("components/graphs/graph-stacked-bar/graph-stacked-bar.tpl.html",""),t.put("components/graphs/graph-timeline/graph-timeline.tpl.html",""),t.put("components/graphs/graph-vertical-bar/graph-vertical-bar.tpl.html",""),t.put("components/maps/access-to-transit/access-to-transit.tpl.html",'<section class="section section--charcoal section--grid section--map map-access-to-transit">\n\n	<div\n		class="map-image map-image--level-{{ $index }}"\n		ng-repeat="layer in mapControls.layers track by $index"\n		ng-class="{\'map-image--active\': mapControls.layers[$index], \'map-image--lq\': useLQ}">\n	</div>\n\n	<div class="map-image map-image--background map-image--active"></div>\n\n	<div class="container-wrapper container-wrapper--full-width">\n\n		<div class="sectioncopy-intro sectioncopy-intro--map">\n			<h4 class="bar-heading bar-heading--inline-block bar-heading--inverse" ng-bind="copy.content.mapTitle"></h4>\n\n			<popover content-text="copy.content"></popover>\n		</div>\n\n		<map-controls\n			style-type="\'small\'"\n			content="content"\n			options="options"\n			map-controls="mapControls">\n		</map-controls>\n	</div>\n</section>\n'),t.put("components/maps/bridge-condition/bridge-condition.tpl.html",'<section class="section section--white section--grid section--map bridgesquality">\n\n	<div class="container-wrapper container-wrapper--full-width">\n		<div class="sectioncopy-intro sectioncopy-intro--map">\n			<h4 class="bar-heading bar-heading--inline-block" ng-bind="copy.content.mapTitle"></h4>\n\n			<popover content-text="copy.content"></popover>\n\n			<!-- map interaction -->\n			<div class="map-interaction">\n				<div\n					ng-click="mapControls.zoomIn()"\n					class="map-interaction__btn map-interaction__btn--first map-interaction__btn--zoom-in">\n					<div class="map-interaction__btn__icon"></div>\n					<div class="map-interaction__btn__expand">Zoom in</div>\n				</div>\n				<div\n					ng-click="mapControls.zoomOut()"\n					class="map-interaction__btn map-interaction__btn--zoom-out">\n					<div class="map-interaction__btn__icon"></div>\n					<div class="map-interaction__btn__expand">Zoom out</div>\n				</div>\n			</div>\n		</div>\n\n		<div\n			class="map-controls map-controls--medium"\n			ng-class="{\'map-controls--open\': mapControls.toggleContent}">\n			<!-- Header -->\n			<div class="map-controls__head">\n\n				<div class="columns columns--two">\n					<div\n						ng-repeat="head in content.head"\n						class="columns__column"\n						ng-class="{\'columns__column--first\': $first}">\n						<h5 class="mapstat-heading" ng-bind="head.title"></h5>\n					</div>\n				</div>\n				<div class="columns columns--two">\n					<div class="columns__column columns__column--first">\n						<div class="mapstat-figure text-color-primary-mixed" ng-bind="content.head[0].figure"></div>\n					</div>\n					<div class="columns__column">\n						<div>\n							<span class="mapstat-figure text-color-quaternary" ng-bind="content.head[1].figure"></span>\n						</div>\n					</div>\n				</div>\n\n				<svg\n					ng-click="mapControls.toggleContent = !mapControls.toggleContent"\n					class="map-controls__icon map-controls__icon--minmax"\n					ng-class="{\'map-controls__icon--open\': mapControls.toggleContent}"\n					version="1.1"\n					xmlns="http://www.w3.org/2000/svg"\n					xmlns:xlink="http://www.w3.org/1999/xlink"\n					x="0px"\n					y="0px"\n					width="22px"\n					height="22px"\n					viewBox="0 0 22 22"\n					xml:space="preserve">\n					<circle class="svg-circle" fill="none" stroke="#5888AA" stroke-miterlimit="10" cx="10.5" cy="10.5" r="10"/>\n					<line class="svg-line-first" fill="none" stroke="#5888AA" stroke-miterlimit="10" x1="5.04" y1="9.81" x2="16.04" y2="9.81"/>\n					<line class="svg-line-second" fill="none" stroke="#5888AA" stroke-miterlimit="10" x1="10.54" y1="15.31" x2="10.54" y2="4.31"/>\n				</svg>\n			</div>\n\n			<!-- Content -->\n			<div\n				class="map-controls__content"\n				ng-if="mapControls.toggleContent">\n\n				<h5 class="mapstat-heading-sans" ng-bind="content.timeline.title"></h5>\n				<timelined3 selected-data="$parent.selectedOption" currentyear="$parent.currentyear" width="386" height="120" paddingleft="41" paddingright="41" liveupdate="0"></timelined3>\n\n			</div>\n			<div\n				class="map-controls__content map-controls__content--border-top"\n				ng-if="mapControls.toggleContent">\n\n				<p\n					class="map-controls__head__name text-small"\n					ng-class="{\'map-controls-inactive\': currentyear != \'2013\'}"\n					ng-bind="content.toggler.title"></p>\n\n				<div>\n					<button\n						class="button button--radio button--primary-mixed"\n						ng-class="{\n							\'button--active\': activeRadio.radio1,\n							\'button--disabled\': currentyear != \'2013\',\n						}"\n						ng-click="currentyear == \'2013\' && mapControls.showProper(); currentyear == \'2013\' && toggleActiveRadio(\'radio1\')">\n						Not deficient\n					</button>\n					<button\n						class="button button--radio button--quaternary"\n						ng-class="{\n							\'button--active\': activeRadio.radio2,\n							\'button--disabled\': currentyear != \'2013\',\n						}"\n						ng-click="currentyear == \'2013\' && mapControls.showDeficient(); currentyear == \'2013\' && toggleActiveRadio(\'radio2\')">\n						Structurally deficient\n					</button>\n				</div>\n			</div>\n		</div>\n\n	</div>\n\n\n	<div id="bridgesquality" class="bridgesquality__map">\n\n		<!-- visual -->\n		<div id="bridgesquality__d3" class="bridgesquality__map__d3">\n			<svg>\n				<defs>\n					<pattern class="patterns" id="lakePatternBridge" patternUnits="userSpaceOnUse" width="6" height="6">\n						<!-- White background (when next color has a opacity < 1) -->\n						<rect width="6" height="6" style="fill: rgb(255, 255, 255);"></rect>\n						<!-- Fill with color -->\n						<rect width="6" height="6" style="fill: rgb(91, 197, 241); opacity: 0.25;"></rect>\n						<!-- Dotted pattern -->\n						<circle cx="3" cy="3" r="1" style="fill: rgb(91, 197, 241); opacity: 0.35;"></circle>\n					</pattern>\n				</defs>\n			</svg>\n		</div>\n		<!-- end visual -->\n\n		<!-- highlight -->\n		<div\n			class="map-highlight map-highlight--version-quaternary"\n			ng-style="highlightCSS"\n			ng-class="highlightClass">\n\n			<h6 class="map-highlight__header map-highlight__header--border-bottom">Year built</h6>\n			<div class="map-highlight__number" ng-bind="highlightContent.YEAR_BUILT"></div>\n\n		</div>\n		<!-- end highlight -->\n	</div>\n</section>\n'),t.put("components/maps/congestion/congestion.tpl.html",'<section class="section section--white section--grid section--map congestion">\n\n	<div class="container-wrapper container-wrapper--full-width">\n\n		<div class="sectioncopy-intro">\n			<h4 class="bar-heading bar-heading--inline-block" ng-bind="copy.content.mapTitle"></h4>\n\n			<popover content-text="copy.content"></popover>\n\n			<!-- map interaction -->\n			<div class="map-interaction">\n				<div\n					ng-click="resetView()"\n					ng-class="{\'map-interaction__btn--zoom-reset--show\': currentHighlight != false }"\n					class="map-interaction__btn map-interaction__btn--zoom-reset">\n					<div class="map-interaction__btn__icon"></div>\n					<div class="map-interaction__btn__expand">Reset zoom</div>\n				</div>\n			</div>\n\n		</div>\n\n		<!-- Map Controls -->\n		<div\n			class="map-controls map-controls--medium"\n			ng-class="{\'map-controls--open\': mapControls.toggleContent}">\n\n			<!-- Header -->\n			<div class="map-controls__head">\n\n				<div class="mapstat-container">\n					<div>\n						<h5 class="mapstat-heading">{{copy.map.headTime}}</h5>\n					</div>\n					<div>\n						<div class="mapstat-figure text-color-primary-sky" ng-bind="timeline.time12"></div>\n					</div>\n				</div>\n\n				<div class="mapstat-container">\n					<div>\n						<h5 class="mapstat-heading" ng-bind="copy.map.headSpeed"></h5>\n					</div>\n					<div>\n						<div class="mapstat-figure text-color-primary-sky" ng-bind="avgSpeed"></div>\n					</div>\n				</div>\n\n				<svg\n					ng-click="mapControls.toggleContent = !mapControls.toggleContent"\n					class="map-controls__icon map-controls__icon--minmax"\n					ng-class="{\'map-controls__icon--open\': mapControls.toggleContent}"\n					version="1.1"\n					xmlns="http://www.w3.org/2000/svg"\n					xmlns:xlink="http://www.w3.org/1999/xlink"\n					x="0px"\n					y="0px"\n					width="22px"\n					height="22px"\n					viewBox="0 0 22 22"\n					xml:space="preserve">\n					<circle class="svg-circle" fill="none" stroke="#5888AA" stroke-miterlimit="10" cx="10.5" cy="10.5" r="10"/>\n					<line class="svg-line-first" fill="none" stroke="#5888AA" stroke-miterlimit="10" x1="5.04" y1="9.81" x2="16.04" y2="9.81"/>\n					<line class="svg-line-second" fill="none" stroke="#5888AA" stroke-miterlimit="10" x1="10.54" y1="15.31" x2="10.54" y2="4.31"/>\n				</svg>\n			</div>\n\n			<!-- Content -->\n			<div\n				class="map-controls__content"\n				ng-if="mapControls.toggleContent">\n\n				<h5 class="mapstat-heading-sans" ng-bind="copy.map.body"></h5>\n\n				<div\n					class="map-controls__option"\n					ng-repeat="option in points"\n					ng-class="{\'map-controls__option--selected\': currentHighlight.id == option.id}"\n					ng-click="highlightPoint(option)">\n\n					<span ng-if="false" class="map-controls__option__color map-controls__option__color--circle" ng-style="{\'background-color\': \'#3498c7\', \'color\': \'#3498c7\'}"></span>\n					<span class="map-controls__option__title" ng-bind-html="toLining(option.label)"></span>\n					<!-- <span class="map-controls__option__amount text-color-primary-sky">{{avgSpeed}} mph</span> -->\n\n				</div>\n			</div>\n\n			<div class="map-controls__content map-controls__content--border-top map-controls__content--no-side-padding">\n\n				<timeline\n					for-video=".congestion-video"\n					start="05:30"\n					end="19:46"\n					range="hours"\n					ng-if="video"\n				></timeline>\n\n			</div>\n\n		</div>\n\n	</div>\n\n</section>\n'),t.put("components/maps/congestion-fallback/congestion-fallback.tpl.html",'<section class="section section--white section--grid section--map congestion-fallback">\n\n	<fallback src="data/fallbacks/congestion/fallback" overlay="true" ratio="0.6"></fallback>\n\n	<div class="container-wrapper container-wrapper--full-width">\n\n		<div class="sectioncopy-intro">\n			<h4 class="bar-heading bar-heading--inline-block" ng-bind="copy.content.mapTitle"></h4>\n			<popover content-text="copy.content"></popover>\n		</div>\n\n	</div>\n\n</section>\n'),t.put("components/maps/createprojects/createprojects.tpl.html",'<section class="section section--black section--grid section--map createprojects" id="createprojects">\n\n\n	<div class="container-wrapper container-wrapper--full-width">\n\n\n		<div class="sectioncopy-intro sectioncopy-intro--map">\n			<h4 class="bar-heading bar-heading--inline-block bar-heading--inverse" ng-bind="copy.content.mapTitle"></h4>\n\n			<popover content-text="copy.content"></popover>\n\n			<!-- map interaction -->\n			<div class="map-interaction">\n				<div\n					ng-click="mapControls.zoomIn()"\n					class="map-interaction__btn map-interaction__btn--first map-interaction__btn--zoom-in">\n					<div class="map-interaction__btn__icon"></div>\n					<div class="map-interaction__btn__expand">Zoom in</div>\n				</div>\n				<div\n					ng-click="mapControls.zoomOut()"\n					class="map-interaction__btn map-interaction__btn--zoom-out">\n					<div class="map-interaction__btn__icon"></div>\n					<div class="map-interaction__btn__expand">Zoom out</div>\n				</div>\n			</div>\n		</div>\n\n		<!-- Map Controls -->\n		<div\n		class="map-controls map-controls--medium"\n		ng-class="{\'map-controls--open\': mapControls.toggleContent}">\n			<!-- Header -->\n\n			<div class="map-controls__head">\n\n				<div>\n					<h5 class="mapstat-heading" ng-bind="content.head[0].title"></h5>\n				</div>\n				<div>\n					<div class="mapstat-figure text-color-primary-saturate" ng-bind="content.head[0].figure"></div>\n				</div>\n\n				<svg\n					ng-click="mapControls.toggleContent = !mapControls.toggleContent"\n					class="map-controls__icon map-controls__icon--minmax"\n					ng-class="{\'map-controls__icon--open\': mapControls.toggleContent}"\n					version="1.1"\n					xmlns="http://www.w3.org/2000/svg"\n					xmlns:xlink="http://www.w3.org/1999/xlink"\n					x="0px"\n					y="0px"\n					width="22px"\n					height="22px"\n					viewBox="0 0 22 22"\n					xml:space="preserve">\n					<circle class="svg-circle" fill="none" stroke="#5888AA" stroke-miterlimit="10" cx="10.5" cy="10.5" r="10"/>\n					<line class="svg-line-first" fill="none" stroke="#5888AA" stroke-miterlimit="10" x1="5.04" y1="9.81" x2="16.04" y2="9.81"/>\n					<line class="svg-line-second" fill="none" stroke="#5888AA" stroke-miterlimit="10" x1="10.54" y1="15.31" x2="10.54" y2="4.31"/>\n				</svg>\n			</div>\n\n			<!-- Content PROJECTS -->\n			<div\n				class="map-controls__content"\n				ng-if="mapControls.toggleContent">\n				<p class="map-controls__head__name text-small" ng-bind="controloptions.points[0].title"></p>\n				<div\n					class="map-controls__option"\n					ng-repeat="option in controloptions.points[0].options"\n					ng-class="{\'map-controls__option--selected\': activeRadio[$index]}"\n					ng-click="mapControls.toggleProjects(option.shortcut); toggleActiveRadio($index)">\n\n					<img class="map-controls__option__icon" ng-src="{{ option.icon }}"></img>\n\n					<span class="map-controls__option__title" ng-bind-html="toLining(option.name)"></span>\n					<p\n						class="text-color-primary-saturate map-controls__option__description"\n						ng-if="mapControls.layers[$index]"\n						ng-bind="option.description">\n					</p>\n\n				</div>\n			</div>\n\n			<!-- Content CORRIDORS -->\n			<div\n				class="map-controls__content"\n				ng-if="mapControls.toggleContent">\n\n				<p class="map-controls__head__name text-small" ng-bind="controloptions.points[1].title"></p>\n\n				<div\n					class="map-controls__option map-controls__option--selected"\n					ng-repeat="option in controloptions.points[1].options"\n					ng-mouseover="mapControls.highLightCorridor(option.id)"\n					ng-mouseleave="mapControls.highLightCorridor(-1)"\n					ng-style="{\'cursor\': \'default\'}">\n\n					<span class="map-controls__option__color map-controls__option__color--rect" ng-style="{\'background-color\': \'{{option.color}}\'}" ></span>\n\n					<span class="map-controls__option__title" ng-bind="option.name"></span>\n					<p\n						class="text-color-primary-saturate map-controls__option__description"\n						ng-if="mapControls.layers[$index]"\n						ng-bind="option.description">\n					</p>\n\n				</div>\n			</div>\n		</div>\n\n	</div>\n\n	<div class="createprojects__map">\n\n		<!-- visual -->\n		<div id="createprojects__d3" class="createprojects__map__d3">\n			<svg>\n				<defs>\n					<pattern class="patterns" id="lakePatternCreate" patternUnits="userSpaceOnUse" width="6" height="6">\n						<!-- Fill with color -->\n						<rect width="6" height="6" style="fill: rgb(56, 142, 155); opacity: 1;"></rect>\n						<!-- Dotted pattern -->\n						<circle cx="3" cy="3" r="1" style="fill: rgb(50, 127, 139); opacity: 1;"></circle>\n					</pattern>\n				</defs>\n			</svg>\n		</div>\n		<!-- end visual -->\n\n		<!-- highlight -->\n		<div\n			class="map-highlight map-highlight--version-secondary"\n			ng-style="highlightCSS" ng-class="highlightClass">\n\n			<h2 class="map-highlight__header" ng-bind="highlightContent.NAME"></h2>\n			<p class="map-highlight__description" ng-bind="highlightContent.KEY_BEN"></p>\n\n		</div>\n		<!-- end highlight -->\n	</div>\n\n</section>\n'),t.put("components/maps/crossingdelay/crossingdelay.tpl.html",'<section id="crossingdelay" class="section section--white section--grid section--map crossingdelay crossingdelay__map">\n\n		<div class="container-wrapper container-wrapper--full-width">\n\n			<div class="sectioncopy-intro sectioncopy-intro--map">\n				<h4 class="bar-heading bar-heading--inline-block" ng-bind="copy.content.mapTitle"></h4>\n\n				<popover content-text="copy.content"></popover>\n\n				<!-- map interaction -->\n				<div class="map-interaction">\n					<div\n						ng-click="mapControls.zoomIn()"\n						class="map-interaction__btn map-interaction__btn--first map-interaction__btn--zoom-in">\n						<div class="map-interaction__btn__icon"></div>\n						<div class="map-interaction__btn__expand">Zoom in</div>\n					</div>\n					<div\n						ng-click="mapControls.zoomOut()"\n						class="map-interaction__btn map-interaction__btn--zoom-out">\n						<div class="map-interaction__btn__icon"></div>\n						<div class="map-interaction__btn__expand">Zoom out</div>\n					</div>\n				</div>\n			</div>\n\n			<!-- Map Controls -->\n			<div\n				class="map-controls map-controls--medium"\n				ng-class="{\'map-controls--open\': mapControls.toggleContent}">\n\n				<!-- Header -->\n				<div class="map-controls__head">\n\n					<h5 class="mapstat-heading" style="margin-bottom: 0;" ng-bind-html="content.head[0].title"></h5>\n\n					<div class="columns columns--two">\n						<div class="columns__column columns__column--first">\n							<h5 class="mapstat-heading " ng-bind="content.head[1].title"></h5>\n						</div>\n						<div class="columns__column">\n							<h5 class="mapstat-heading" ng-bind="content.head[2].title"></h5>\n						</div>\n					</div>\n					<div class="columns columns--two">\n						<div class="columns__column columns__column--first">\n							<div class="mapstat-figure text-color-tertiary" ng-bind="content.head[1].figure"></div>\n						</div>\n						<div class="columns__column">\n							<div>\n								<span class="mapstat-figure text-color-tertiary" ng-bind="content.head[2].figure"></span>\n							</div>\n						</div>\n					</div>\n\n					<div>\n						<h5 class="mapstat-heading" ng-bind="content.head[3].title"></h5>\n						<span class="mapstat-figure text-color-tertiary" ng-bind="content.head[3].figure"></span>\n					</div>\n\n					<svg\n						ng-click="mapControls.toggleContent = !mapControls.toggleContent"\n						class="map-controls__icon map-controls__icon--minmax"\n						ng-class="{\'map-controls__icon--open\': mapControls.toggleContent}"\n						version="1.1"\n						xmlns="http://www.w3.org/2000/svg"\n						xmlns:xlink="http://www.w3.org/1999/xlink"\n						x="0px"\n						y="0px"\n						width="22px"\n						height="22px"\n						viewBox="0 0 22 22"\n						xml:space="preserve">\n						<circle class="svg-circle" fill="none" stroke="#5888AA" stroke-miterlimit="10" cx="10.5" cy="10.5" r="10"/>\n						<line class="svg-line-first" fill="none" stroke="#5888AA" stroke-miterlimit="10" x1="5.04" y1="9.81" x2="16.04" y2="9.81"/>\n						<line class="svg-line-second" fill="none" stroke="#5888AA" stroke-miterlimit="10" x1="10.54" y1="15.31" x2="10.54" y2="4.31"/>\n					</svg>\n				</div>\n\n				<!-- Content -->\n				<div\n					class="map-controls__content"\n					ng-if="mapControls.toggleContent">\n\n					<h5 class="mapstat-heading-sans" ng-bind="content.options.title"></h5>\n\n					<div\n						class="map-controls__option"\n						ng-repeat="option in options"\n						ng-class="{\'map-controls__option--selected\': currentSelectedCrossing == option.CROSSING}"\n						ng-click="mapControls.setFocus(option.CROSSING)">\n\n						<span class="map-controls__option__color map-controls__option__color--circle" ng-style="{\'background-color\': \'#ff504e\', \'color\': \'#ff504e\'}"></span>\n						<span class="map-controls__option__title" ng-bind-html="toLining(option.ImprovedName)"></span>\n						<span class="map-controls__option__amount" ng-style="{\'color\': \'#ff504e\'}">{{ option.Total_Hour | number:1 }}</span>\n\n					</div>\n				</div>\n\n				<div\n					class="map-controls__content map-controls__content--border-top"\n					ng-if="mapControls.toggleContent">\n\n					<p class="map-controls__head__name text-small" ng-bind="content.toggler.title"></p>\n\n					<p>\n						<button\n							class="button button--radio button--tertiary button--blurred button--small"\n							ng-class="{\'button--active\': activeRadio[0]}"\n							ng-click="mapControls.setFullSize(); toggleActiveRadio(0)">\n							Crossing delay\n						</button>\n					</p>\n				</div>\n			</div>\n\n		</div>\n\n		<!-- visual -->\n		<div id="crossingdelay__d3" class="crossingdelay__map__d3">\n			<svg>\n				<defs>\n					<pattern class="patterns" id="lakePatternCrossings" patternUnits="userSpaceOnUse" width="6" height="6">\n						<!-- White background (when next color has a opacity < 1) -->\n						<rect width="6" height="6" style="fill: rgb(255, 255, 255);"></rect>\n						<!-- Fill with color -->\n						<rect width="6" height="6" style="fill: rgb(91, 197, 241); opacity: 0.25;"></rect>\n						<!-- Dotted pattern -->\n						<circle cx="3" cy="3" r="1" style="fill: rgb(91, 197, 241); opacity: 0.35;"></circle>\n					</pattern>\n				</defs>\n			</svg>\n		</div>\n		<!-- end visual -->\n\n		<!-- highlight -->\n		<div\n			class="map-highlight map-highlight--version-tertiary"\n			ng-style="highlightCSS"\n			ng-class="highlightClass">\n\n			<h6 class="map-highlight__header" ng-bind="highlightContent.Street"></h6>\n\n			<div class="table table--three-cols">\n				<div class="table__cell">\n					<div class="map-highlight__number" ng-bind="highlightContent.Total_Hour | number:2"></div>\n					<div class="map-highlight__annotation">\n						total hours of aggregate delay\n					</div>\n				</div>\n				<div class="table__cell">\n					<div class="map-highlight__number" ng-bind="highlightContent.Vehicles_D | number:0"></div>\n					<div class="map-highlight__annotation">\n						vehicles delayed\n					</div>\n				</div>\n				<div class="table__cell">\n					<div class="map-highlight__number" ng-bind="highlightContent.Avg_Gate_D | number:2 "></div>\n					<div class="map-highlight__annotation">\n						gate down / train (minutes average)\n					</div>\n				</div>\n			</div>\n		</div>\n		<!-- end highlight -->\n\n	</div>\n\n</section>\n'),t.put("components/maps/landing-page/landing-page.tpl.html",'<figure>\n	<figcaption class="keystat keystat--rails" ng-mouseenter="highlight(\'rails\')" ng-mouseleave="highlight(\'none\')">\n		<h5 class="keystat__title">Rail</h5>\n		<div class="text-color-primary-sky keystat__value-container">\n			<span class="keystat__value">3,865</span>\n			<span class="keystat__metric">miles</span>\n		</div>\n	</figcaption>\n	<figcaption class="keystat keystat--roads" ng-mouseenter="highlight(\'roads\')" ng-mouseleave="highlight(\'none\')">\n		<h5 class="keystat__title">Road</h5>\n		<div class="text-color-quaternary keystat__value-container">\n			<span class="keystat__value">29,989</span>\n			<span class="keystat__metric">miles</span>\n		</div>\n	</figcaption>\n</figure>\n\n<div class="compass">\n	<div class="needle"></div>\n</div>\n'),t.put("components/maps/map-controls/map-controls.tpl.html",'<div class="map-controls map-controls--small" ng-if="styleType() === \'small\'">\n	<!-- Header -->\n	<div class="map-controls__head" ng-click="mapControls.toggleContent = !mapControls.toggleContent">\n\n		<span class="map-controls__head__name text-small">{{ content().head.title }}</span>\n\n		<svg\n			class="map-controls__icon map-controls__icon--minmax"\n			ng-class="{\'map-controls__icon--open\': mapControls.toggleContent}"\n			version="1.1"\n			xmlns="http://www.w3.org/2000/svg"\n			xmlns:xlink="http://www.w3.org/1999/xlink"\n			x="0px"\n			y="0px"\n			width="22px"\n			height="22px"\n			viewBox="0 0 22 22"\n			xml:space="preserve">\n			<circle class="svg-circle" fill="none" stroke="#5888AA" stroke-miterlimit="10" cx="10.5" cy="10.5" r="10"/>\n			<line class="svg-line-first" fill="none" stroke="#5888AA" stroke-miterlimit="10" x1="5.04" y1="9.81" x2="16.04" y2="9.81"/>\n			<line class="svg-line-second" fill="none" stroke="#5888AA" stroke-miterlimit="10" x1="10.54" y1="15.31" x2="10.54" y2="4.31"/>\n		</svg>\n	</div>\n\n	<!-- Content -->\n	<div\n		class="map-controls__content"\n		ng-if="mapControls.toggleContent">\n		<div\n			class="map-controls__section"\n			ng-repeat="option in options().points">\n\n			<div\n				class="map-controls__option"\n				ng-class="{\'map-controls__option--selected\': mapControls.layers[$index]}"\n				ng-click="mapControls.switchLayer($index)"\n				ng-mouseenter="mapControls.toggleHover($index)"\n				ng-mouseleave="mapControls.toggleHover(99999)">\n\n				<span\n					class="map-controls__option__color map-controls__option__color--box"\n					ng-style="\n						(mapControls.layers[$index] && {\'background-color\': option.color, \'outline-color\': option.color}) ||\n						(mapControls.isHovered == $index && mapControls.layers[$index] && {\'background-color\': option.color, \'outline-color\': option.color}) ||\n						(mapControls.isHovered == $index && {\'background-color\': option.color, \'outline-color\': option.color})">\n				</span>\n\n				<span class="map-controls__option__title" ng-bind="toLining(option.name)"></span>\n\n				<div class="map-controls__option__explain">\n					<div class="map-controls__option__explain__icon">\n						<img src="images/icons/questionmark.svg" alt="">\n\n						<div\n							class="text-color-primary-saturate map-controls__option__explain__content"\n							ng-bind="option.description">\n						</div>\n					</div>\n				</div>\n\n\n			</div>\n		</div>\n	</div>\n</div>\n\n\n<div\n	class="map-controls map-controls--medium"\n	ng-class="{\'map-controls--open\': mapControls.toggleContent}"\n	ng-if="styleType() === \'medium\'">\n	<!-- Header -->\n	<div class="map-controls__head">\n\n		<div class="columns columns--two">\n			<div\n				ng-repeat="head in content().head"\n				class="columns__column">\n				<h5 class="mapstat-heading" ng-bind="head.title"></h5>\n			</div>\n		</div>\n		<div class="columns columns--two">\n			<div\n				ng-repeat="head in content().head"\n				class="columns__column">\n				<p class="mapstat-figure text-color-primary-sky" ng-bind="head.figure"></p>\n			</div>\n		</div>\n\n		<svg\n			ng-click="mapControls.toggleContent = !mapControls.toggleContent"\n			class="map-controls__icon map-controls__icon--minmax"\n			ng-class="{\'map-controls__icon--open\': mapControls.toggleContent}"\n			version="1.1"\n			xmlns="http://www.w3.org/2000/svg"\n			xmlns:xlink="http://www.w3.org/1999/xlink"\n			x="0px"\n			y="0px"\n			width="22px"\n			height="22px"\n			viewBox="0 0 22 22"\n			xml:space="preserve">\n			<circle class="svg-circle" fill="none" stroke="#5888AA" stroke-miterlimit="10" cx="10.5" cy="10.5" r="10"/>\n			<line class="svg-line-first" fill="none" stroke="#5888AA" stroke-miterlimit="10" x1="5.04" y1="9.81" x2="16.04" y2="9.81"/>\n			<line class="svg-line-second" fill="none" stroke="#5888AA" stroke-miterlimit="10" x1="10.54" y1="15.31" x2="10.54" y2="4.31"/>\n		</svg>\n	</div>\n\n	<!-- Content -->\n	<div\n		class="map-controls__content"\n		ng-show="mapControls.toggleContent">\n\n		<h5 class="mapstat-heading-sans" ng-bind="content().options.title"></h5>\n		<div\n			class="map-controls__section"\n			ng-class="{\'map-controls__toggle--open\' : toggle[group]}"\n			ng-repeat="(group, title) in options().groups">\n\n			<div\n				class="map-controls__toggle"\n				ng-click="toggle[group] = !toggle[group]">\n				{{ title }}\n				<svg\n					class="map-controls__icon map-controls__icon--arrow"\n					version="1.1"\n					xmlns="http://www.w3.org/2000/svg"\n					xmlns:xlink="http://www.w3.org/1999/xlink"\n					x="0px"\n					y="0px"\n					width="22px"\n					height="22px"\n					viewBox="0 0 22 22"\n					xml:space="preserve">\n					<circle class="svg-circle" fill="none" stroke="#5888AA" stroke-miterlimit="10" cx="10.5" cy="10.5" r="10"/>\n					<polyline class="svg-polyline" fill="none" stroke="#5888AA" stroke-miterlimit="10" points="14.59,12.47 10.37,8.25 6.19,12.39"/>\n				</svg>\n\n			</div>\n\n			<div\n				ng-repeat="option in options().lines"\n				ng-show="toggle[group] && option.group === group"\n				ng-click="mapControls.setFocus($index)"\n				class="map-controls__option"\n				ng-class="{\'map-controls__option--active\': mapControls.currentSelectedLine == $index}">\n\n				<span class="map-controls__option__color" ng-style="{\'background-color\':option.color}"></span>\n				<span class="map-controls__option__title" ng-bind="option.name"></span>\n				<span class="map-controls__option__amount">{{ option.ridership2013 | number }}</span>\n\n			</div>\n		</div>\n	</div>\n	<div\n		class="map-controls__content map-controls__content--border-top"\n		ng-if="mapControls.toggleContent">\n\n		<p class="map-controls__head__name text-small" ng-bind="content().toggler.title"></p>\n\n		<p>\n			<button\n				class="button button--radio button--ridershipblue button--blurred button--small"\n				ng-class="{\'button--active\': mapControls.fullSize}"\n				ng-click="mapControls.setFullSize()">\n				Ridership (<span class="ridership--font-uppercase">2013</span> & <span class="ridership--font-uppercase">2014</span>)\n			</button>\n		</p>\n	</div>\n</div>\n'),t.put("components/maps/ridequality/ridequality.tpl.html",'<section class="section section--charcoal section--grid section--map ridequality">\n\n	<div class="container-wrapper container-wrapper--full-width">\n\n		<div class="sectioncopy-intro sectioncopy-intro--map">\n			<h4 class="bar-heading bar-heading--inline-block bar-heading--inverse" ng-bind="copy.content.mapTitle"></h4>\n\n			<popover content-text="copy.content"></popover>\n		</div>\n\n\n\n		<!-- Map Controls -->\n		<div class="map-controls map-controls--small">\n			<!-- Header -->\n			<div class="map-controls__head" ng-click="toggleContent = !toggleContent">\n\n				<span class="map-controls__head__name text-small" ng-bind="content.head.title"></span>\n				<svg\n					class="map-controls__icon map-controls__icon--minmax"\n					ng-class="{\'map-controls__icon--open\': toggleContent}"\n					version="1.1"\n					xmlns="http://www.w3.org/2000/svg"\n					xmlns:xlink="http://www.w3.org/1999/xlink"\n					x="0px"\n					y="0px"\n					width="22px"\n					height="22px"\n					viewBox="0 0 22 22"\n					xml:space="preserve">\n					<circle class="svg-circle" fill="none" stroke="#5888AA" stroke-miterlimit="10" cx="10.5" cy="10.5" r="10"/>\n					<line class="svg-line-first" fill="none" stroke="#5888AA" stroke-miterlimit="10" x1="5.04" y1="9.81" x2="16.04" y2="9.81"/>\n					<line class="svg-line-second" fill="none" stroke="#5888AA" stroke-miterlimit="10" x1="10.54" y1="15.31" x2="10.54" y2="4.31"/>\n				</svg>\n			</div>\n\n			<!-- Content -->\n			<div\n				class="map-controls__content map-controls__content--padding-bottom"\n				ng-show="toggleContent">\n\n				<div\n					class="map-controls__section"\n					ng-repeat="option in options">\n\n					<div\n						class="map-controls__option"\n						ng-class="{\'map-controls__option--selected\': mapControls.isSelected == option.name}"\n						ng-click="mapControls.setMode(option)"\n						ng-mouseenter="mapControls.toggleHover(option.name)"\n						ng-mouseleave="mapControls.toggleHover(\'\')">\n\n						<span\n							class="map-controls__option__color map-controls__option__color--circle"\n							ng-style="\n								(mapControls.isSelected == option.name && {\'background-color\': option.color, \'color\': option.color}) ||\n								(mapControls.isHovered == option.name && mapControls.isSelected == option.name && {\'background-color\': option.color, \'color\': option.color}) ||\n								(mapControls.isHovered == option.name && {\'color\': option.color})">\n						</span>\n						<span class="map-controls__option__title" ng-bind="option.name"></span>\n						<p\n							class="text-color-primary-saturate map-controls__option__description"\n							ng-if="mapControls.layers[$index]"\n							ng-bind="option.description"></p>\n\n					</div>\n				</div>\n\n			</div>\n			<div\n				class="map-controls__content map-controls__content--border-top map-controls__content--timeline"\n				ng-show="toggleContent">\n\n				<span class="map-controls__head__name text-small" ng-bind="content.timeline.title"></span>\n				<timelined3 selected-data="selectedOption" currentyear="currentyear" width="300" height="100" paddingleft="53" paddingright="53" liveupdate="1"></timelined3>\n\n			</div>\n		</div>\n\n	</div>\n\n	<div id="ridequality" class="ridequality__map">\n		<!-- visual -->\n		<div id="ridequality__d3" class="ridequality__map__d3">\n		</div>\n\n	</div>\n\n</section>\n'),t.put("components/maps/ridership/ridership.tpl.html",'<section class="section section--white section--grid section--map ridership">\n\n		<div class="container-wrapper container-wrapper--full-width">\n\n			<div class="sectioncopy-intro sectioncopy-intro--map">\n				<h4 class="bar-heading bar-heading--inline-block" ng-bind="copy.content.mapTitle"></h4>\n\n				<popover content-text="copy.content"></popover>\n\n				<!-- map interaction -->\n				<div class="map-interaction">\n					<div\n						ng-click="mapControls.zoomIn()"\n						class="map-interaction__btn map-interaction__btn--first map-interaction__btn--zoom-in">\n						<div class="map-interaction__btn__icon"></div>\n						<div class="map-interaction__btn__expand">Zoom in</div>\n					</div>\n					<div\n						ng-click="mapControls.zoomOut()"\n						class="map-interaction__btn map-interaction__btn--zoom-out">\n						<div class="map-interaction__btn__icon"></div>\n						<div class="map-interaction__btn__expand">Zoom out</div>\n					</div>\n				</div>\n			</div>\n\n			<map-controls\n				style-type="\'medium\'"\n				content="content"\n				options="options"\n				map-controls="mapControls">\n			</map-controls>\n\n		</div>\n\n		<!-- visual -->\n		<div id="ridership__d3" class="ridership__d3">\n			<svg>\n				<defs>\n					<pattern class="patterns" id="lakePattern" patternUnits="userSpaceOnUse" width="6" height="6">\n						<!-- White background (when next color has a opacity < 1) -->\n						<rect width="6" height="6" style="fill: rgb(255, 255, 255);"></rect>\n						<!-- Fill with color -->\n						<rect width="6" height="6" style="fill: rgb(91, 197, 241); opacity: 0.25;"></rect>\n						<!-- Dotted pattern -->\n						<circle cx="3" cy="3" r="1" style="fill: rgb(91, 197, 241); opacity: 0.35;"></circle>\n					</pattern>\n				</defs>\n			</svg>\n		</div>\n		<!-- end visual -->\n\n		<!-- highlight -->\n		<div\n			class="map-highlight map-highlight--version-primary"\n			ng-style="highlightCSS"\n			ng-class="highlightClass">\n\n			<h6\n				class="map-highlight__header map-highlight__header--border-bottom"\n				ng-bind="highlightContent.LONGNAME">\n			</h6>\n\n			<div class="table">\n				<div class="table__cell">\n					<div class="map-highlight__number" ng-bind="highlightContent.rdrShip | number | hasValue"></div>\n				</div>\n				<div class="table__cell">\n					<div class="map-highlight__annotation">\n						boardings per weekday <span class="ridership--font-uppercase" ng-bind="highlightContent.rdrShipYR"></span>\n					</div>\n				</div>\n			</div>\n\n		</div>\n		<!-- end highlight -->\n\n</section>\n'),t.put("components/maps/timelined3/timelined3.tpl.html",'<div class="timelined3">\n	<div id="timelined3__d3" class="timelined3__d3">\n		<svg>\n			<defs>\n				<filter id="highlight-drop-shadow-d3" height="130%">\n					<feGaussianBlur in="SourceAlpha" stdDeviation="2" result="blur"></feGaussianBlur>\n					<feOffset in="blur" dx="1" dy="1" result="offsetBlur"></feOffset>\n					<feFlood in="offsetBlur" flood-color="#000000" flood-opacity="0.25" result="offsetColor"></feFlood>\n					<feComposite in="offsetColor" in2="offsetBlur" operator="in" result="offsetBlur"></feComposite>\n					<feMerge><feMergeNode in="offsetBlur"></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge>\n				</filter>\n			</defs>\n		</svg>\n	</div>\n</div>\n')
}]),angular.module("cmapMobilityApp").controller("SplashCtrl",["$scope","copydata","webglTest","renderService",function(t,n,e,i){t.webGL=e.check(),t.render=i,t.webGL||i.finished(),t.loaded=!0,t.copy=n}]),angular.module("cmapMobilityApp").controller("IntroductionCtrl",["$scope","copydata","renderService",function(t,n,e){t.copy=n,e.finished()}]),angular.module("cmapMobilityApp").controller("IndicatorCtrl",["$rootScope","$scope","$stateParams","$timeout","copydata","webglTest","renderService",function(t,n,e,i,a,r,o){n.currentIndicator=e.indicatorId,n.state=e,n.webGL=r.check(),n.render=o,n.loaded=!1,n.copy=a,n.mapControls={};var s=function(){var t,e;if(n.currentIndicator)for(t=n.copy.indicators,e=0;e<t.length;e++)t[e].url===n.currentIndicator&&(n.copy=t[e],n.loaded=!0)};s(),i(o.finished,0);var l=/^((?!chrome).)*safari/i.test(navigator.userAgent),c=-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0;n.hideCongestion=l||c}]),angular.module("cmapMobilityApp").service("colors",function(){var t=["primary","secondary","tertiary","quaternary"];this.get=function(n){return t[n]}}),angular.module("cmapMobilityApp").service("Dispatcher",["$http","$q",function(t,n){var e,i=["data/copy/copy.data.json"],a=[],r=function(){var r=n.defer();return angular.forEach(i,function(n){a.push(t({method:"GET",url:n,cache:!0}))}),n.all(a).then(function(t){e=t,r.resolve(t[0].data)},function(t){throw r.reject(t),Error(t)}),r.promise};return{makeCall:r}}]),angular.module("cmapMobilityApp").service("sharedCopyDataService",function(){this.copyData={},this.setCopy=function(t,n){var e,i,a=n.topic;if("splash"===t)return this.setCopyData(n.introduction[0]),n.introduction[0];if(t.stepId){var r=n.introduction[0].introduction;for(i=0;i<r.length;i++)if(r[i].url===t.stepId)return this.setCopyData(r[i]),r[i]}else if(t.indicatorId){for(i=0;i<a.length;i++)if(a[i].url===t.topicId)for(e=a[i].indicators,i=0;i<e.length;i++)if(e[i].url===t.indicatorId)return this.setCopyData(e[i]),e[i]}else if(t.topicId)for(i=0;i<a.length;i++)if(a[i].url===t.topicId)return this.setCopyData(a[i]),a[i]},this.setCopyData=function(t){t?angular.extend(this,t):console.error("No data defined!")}}),angular.module("cmapMobilityApp").factory("sharedDataFactory",["Dispatcher","$q",function(t,n){var e,i=[],a=function(){return e},r=function(){var i=n.defer();return void 0!==e?i.resolve(e):t.makeCall().then(function(t){e=t,i.resolve(e)}),i.promise},o=function(t){-1===i.indexOf(t)&&i.push(t)},s=function(t){return-1!==i.indexOf(t)?!0:!1};return{addVisited:o,checkIsVisited:s,setData:r,getData:a}}]),angular.module("cmapMobilityApp").factory("DataLoader",["$q","$http",function(t,n){return function(e){var i,a,r,o,s=!1;this.setBoundingBox=function(t,n){return o={min:t,max:n},this},this.getBoundingBox=function(){var t,n;if(r instanceof CMAP.classes.Projection&&o){var e=r.translate(o.min[0],o.min[1]),i=r.translate(o.max[0],o.max[1]);t={},t.min={x:e[0],y:e[1]},t.max={x:i[0],y:i[1]},n={},n.min=new THREE.Vector3(e[0],e[1],0),n.max=new THREE.Vector3(i[0],i[1],0)}return{boxGeo:o,box2D:t,box3D:n}},this.load=function(){var r=this,o=t.defer(),l=e.split(".");if(l=l[l.length-1],s)o.resolve(r);else{if("png"!==l&&"jpg"!==l)return n.get(e,{cache:!1}).success(function(t){i=t.features?"geoJSON":"geoGrid",a=t,o.resolve(r),s=!0}).error(function(){console.error("error retrieving map data")}),o.promise;a=THREE.ImageUtils.loadTexture(e),i="image",o.resolve(r)}},this.setProjection=function(t){return t instanceof CMAP.classes.Projection?r=t:console.warn("projection not loaded properly"),this},this.topoJSON=function(t){return a.type&&"Topology"===a.type&&(a=topojson.feature(a,a.objects[t]),i="geoJSON"),this},this.geoJSON=function(){return a};var l=function(t,n,e){var i=[];return e&&(t=t[0]),t.forEach(function(t){if(0!==t[0]&&0!==t[1]){var e=r.translate3D(t[0],t[1]);i.push(new THREE.Vector3(e.x,e.y,n))}}),i};this.map3D=function(t){switch(i){case"geoJSON":var n=[];return a.features.forEach(function(e){if("LineString"===e.geometry.type)n.push(l(e.geometry.coordinates,t));else if("MultiLineString"===e.geometry.type)e.geometry.coordinates.forEach(function(e){n.push(l(e,t))});else if("Polygon"===e.geometry.type)n.push(l(e.geometry.coordinates,t,!0));else if("Point"===e.geometry.type){var i=e.geometry.coordinates,a=r.translate3D(i[0],i[1],t),o=new THREE.Vector3(a.x,a.y,t);o.properties=e.properties,n.push(o)}else console.warn("Unsupported geoJSON feature:",e.geometry.type)}),n;case"geoGrid":case"image":return a}}}}]),angular.module("cmapMobilityApp").service("dataCollection",["DataLoader","webglTest",function(t,n){var e=[];this.create=function(n,i,a,r){var o=new t(a);return r=r||"D3",e.push({data:o,name:i,indicator:n,type:r}),o},this.load=function(t){for(var i=[],a=n.check(),r=0;r<e.length;r++)(e[r].indicator===t||void 0===e[r].indicator)&&("webGL"!==e[r].type||"webGL"===e[r].type&&a)&&i.push(e[r].data.load());return{waitFor:i}},this.retrieve=function(t){for(var n=0;n<e.length;n++)if(e[n].name===t)return e[n].data;return!1},this.setBoundingBoxes=function(t,n,e){for(var i=0;i<t.length;i++){var a=this.retrieve(t[i]);a.setBoundingBox(n,e)}},this.setProjections=function(t,n){for(var e=0;e<t.length;e++){var i=this.retrieve(t[e]);i.setProjection(n)}}}]),angular.module("cmapMobilityApp").service("webglTest",function(){var t,n=function(){try{var t=document.createElement("canvas");return!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(n){return!1}};this.check=function(){return t=t||n()}}),angular.module("cmapMobilityApp").service("renderService",["$timeout",function(t){this.wait=function(){this.needed=!0,this.done=!1},this.finished=function(){return this.isRendering?!1:void t(function(){this.done=!0}.bind(this),0)}.bind(this),this.startRendering=function(){this.isRendering=!0},this.endRendering=function(){this.isRendering=!1,this.finished()},this.reset=function(){this.needed=!1,this.done=!1},this.reset()}]),angular.module("cmapMobilityApp").service("inviewService",function(){var t,n=[],e=function(){function t(t){var n=(Math.random().toString(16)+"000000000").substr(2,8);return t?"-"+n.substr(0,4)+"-"+n.substr(4,4):n}return t()+t(!0)+t(!0)+t()},i=function(t){return null!==t&&t===t.window},a=function(t){return i(t)?t:9===t.nodeType&&t.defaultView},r=function(t){var n,e,i={top:0,left:0},r=t&&t.ownerDocument;return n=r.documentElement,"undefined"!=typeof t.getBoundingClientRect&&(i=t.getBoundingClientRect()),e=a(r),{top:i.top+e.pageYOffset-n.clientTop,left:i.left+e.pageXOffset-n.clientLeft}},o=function(){window.setTimeout(o,250);var e,i=Math.max(document.body.scrollTop,document.documentElement.scrollTop);if(t===i)return!1;t=i;for(var a=0;a<n.length;a++){e=i+window.innerHeight;var r=n[a];r.top>i&&r.top<e||r.bottom>i&&r.bottom<e||r.top<i&&r.bottom>e?r.inview||(r.inview=!0,r.evt(!0)):r.inview===!0&&(r.inview=!1,r.evt(!1))}};o();var s=function(t){var n=r(t.element[0]);return t.top=n.top,t.bottom=n.top+t.element[0].offsetHeight,t};this.add=function(t,i,a){a=a||0;var r=s({element:t,evt:i,offset:a,inview:!1,id:e()});return n.push(r),r.id},this.clear=function(){n=[]},this.remove=function(t){for(var e=0;e<n.length;e++)n[e].id===t&&n.splice(e,1)};var l=function(){for(var t=0;t<n.length;t++)n[t]=s(n[t])};this.recalculate=l,window.addEventListener("resize",l,!1)}),angular.module("cmapMobilityApp").directive("navigation",["$rootScope","$state","$stateParams","sharedDataFactory","sharedCopyDataService","renderService",function(t,n,e,i,a,r){return{restrict:"E",templateUrl:"components/navigation/navigation.tpl.html",link:function(n){var o={splash:"white",introduction:"introduction",roads:"quaternary",transit:"primary",freight:"tertiary",forward:"secondary"},s={"default":"top-small",splash:"top-medium",topic:"top-large"};n.isVisited=function(t){return i.checkIsVisited(t)},n.getNavTheme=function(){var t="navigation--"+o[n.topicId];return t},n.getMenuTheme=function(t){var e="navigation-menu__wrapper--"+o[t];return"introduction"===t&&void 0===n.topicId?e+=" navigation-menu__wrapper--active":t===n.topicId?e+=" navigation-menu__wrapper--active":t===n.currentState&&(e+=" navigation-menu__wrapper--active"),e},n.getNavState=function(){var t="navigation--",e=s[n.currentState];return t+=void 0!==e?e:s["default"]},n.getMenuState=function(t){var e="";return t===n.topicId?e+="navigation-menu__subnav--active":t===n.currentState&&(e+="navigation-menu__subnav--active"),e},t.$on("$stateChangeStart",function(t,a,o){n.currentState=a.name,n.topicId=o.topicId,(!e.indicatorId||o.indicatorId)&&r.wait();var s;s=o.indicatorId?o.indicatorId:o.topicId?o.topicId:o.stepId?o.stepId:"splash",n.isActive=s,i.addVisited(s);var l=["prioritizing-the-future","driving-the-economy","an-aging-system"];n.activeIndex=l.indexOf(s)}),t.$on("$stateChangeSuccess",function(){document.body.scrollTop=0,document.documentElement.scrollTop=0}),n.$watch(i.getData,function(t,e){t!==e&&(n.data=t)}),n.copy=a}}}]),angular.module("cmapMobilityApp").directive("loader",["$q","$stateParams","dataCollection",function(t,n,e){return{restrict:"E",templateUrl:"components/loader/loader.tpl.html",link:function(){var t={min:[-88.70579,41.205223],max:[-87.52456,42.49564]},n={min:[-89.4617,40.7639],max:[-85.6494,43.0368]};e.create(void 0,"grid","data/maps/grid.geojson"),e.create(void 0,"railLinesLowDetail","data/maps/railnetwork_cleaned.topojson"),e.create(void 0,"counties","data/maps/counties_merged.topojson"),e.create(void 0,"counties_simplified","data/maps/counties_merged_simplified.json"),e.create(void 0,"mapdata","data/maps/map.data.json"),e.create(void 0,"LakeMichigan","data/maps/lake-michigan.topojson"),e.create(void 0,"indicatorData","data/indicator.graph.data.json"),e.create(void 0,"roads","data/maps/hwy_2013_cleaned.topojson"),e.create("congestion","congestionRoads","data/maps/congestion/here_traffic_merge_simplofy20ft-supermerged.topojson","webGL"),e.create("congestion","congestionHighlights","data/maps/congestion/highlights.geojson","webGL"),e.create("home","homeHighlights","data/maps/landing-page/highlights.geojson","webGL"),e.create("home","satellite","data/maps/landing-page/satellite-small-lq.jpg","webGL").setBoundingBox(n.min,n.max),e.setBoundingBoxes(["congestionRoads","congestionHighlights","roads"],t.min,t.max),e.create("ridership","ctaLines","data/maps/ridership/ctaraillines_cta_201303.topojson"),e.create("ridership","metraLines","data/maps/ridership/metralines_rta_201303.topojson"),e.create("ridership","ctaStations","data/maps/ridership/cta_avg_weekdayboard_2001thru2013.topojson"),e.create("ridership","metraStations","data/maps/ridership/metra_weekdayboardings_1983thru2014.topojson"),e.create("crossing-delay","crossing","data/maps/crossingdelay/motoristdelay_atgradecrossings_omitbarringtoneje_201502_cleaned.topojson"),e.create("bridge-condition","bridges","data/maps/bridge-condition/national-bridge-inventory_illinois_2013_updated.cleanedup.topojson"),e.create("bridge-condition","bq-timeline","data/maps/bridge-condition/timeline.json"),e.create("create-projects","corridors","data/maps/createprojects/corridors_poly.topojson"),e.create("create-projects","locations","data/maps/createprojects/create_projects_updated.topojson"),e.create("ride-quality","separated-counties","data/maps/ridequality/7cnty_boundary.topojson"),e.create("ride-quality","dotted-counties","data/maps/ridequality/rq_grid.json")}}}]),angular.module("cmapMobilityApp").directive("spinner",["renderService",function(t){return{restrict:"E",templateUrl:"components/spinner/spinner.tpl.html",link:function(n,e){n.render=t,n.$watch("render.done",function(t){t?e.removeClass("show"):e.addClass("show")})}}}]),angular.module("cmapMobilityApp").directive("fullPageImage",function(){return{restrict:"E",scope:{image:"=",title:"=",description:"="},templateUrl:"components/full-page-image/full-page-image.tpl.html",link:function(t){var n=Math.random();t.cssClass=n>.5?"full-page-image__background-image--even":"full-page-image__background-image--odd"}}}),angular.module("cmapMobilityApp").directive("intro",function(){return{restrict:"E",templateUrl:"components/intro/intro.tpl.html",link:function(){}}}),angular.module("cmapMobilityApp").directive("footer",["$rootScope",function(t){return{restrict:"E",templateUrl:"components/footer/footer.tpl.html",link:function(n){n.openNotification=function(){t.$broadcast("toggleNotification",{isVisible:"credits"})}}}}]),angular.module("cmapMobilityApp").directive("timeline",["$interval",function(t){return{restrict:"E",templateUrl:"components/timeline/timeline.tpl.html",link:function(n,e,i){n.value=0,n.play=!0;var a,r,o,s,l,c,p,d,u=!1,g=e[0].querySelector("svg"),h=d3.select(g),m=h.select(".scrubber-group"),v=h.select(".before-line"),f=h.select(".after-line"),_=h.select(".ticks"),y=h.select(".value"),b=h.select(".value text"),x=9.5,w=396,C=!1,k=function(t){t instanceof Object==!1&&(t={range:t});var n=l*t.range,e=60*parseInt(o[0])+parseInt(o[1])+n,i=Math.floor(e/60),a=Math.floor(e-60*i);return a-=a%15,a=10>a?"0"+a:a,t.hours24=i,t.hours12=i>12?i-12:i,t.minutes=a,t.meridiem=i>11?"pm":"am",t.time24=t.hours24+":"+a,t.time12=t.hours12+":"+a+" "+t.meridiem,t},S=function(t){t>.999&&(t=.999),1e-4>t&&(t=1e-4);var n=p(t),e=t*(d-0),i=n-13;m.attr("transform","translate("+i+",27)"),v.attr("x2",n+x),f.attr("x1",n+x);for(var a=function(t){return e>=t},r=0;d>r;r++)_.select(".tick-"+r).classed("selected",a(r));var o=n-38;y.attr("transform","translate("+o+",0)");var s=k(t).time12;b.text(s)};switch(i.range){case"hours":n.bounds={start:i.start,end:i.end},o=i.start,o=o.split(":"),s=i.end,s=s.split(":"),o[0]=parseInt(o[0]),o[1]=parseInt(o[1]),s[0]=parseInt(s[0]),s[1]=parseInt(s[1]),l=60*(s[0]-o[0])+(s[1]-o[1]),d=s[0]-o[0];break;case"linear":}var A=function(){var t={range:n.value};switch(i.range){case"hours":t=k(t);break;case"linear":t.value=(s-o)*t.range+o}C||S(t.range),n.updateFn instanceof Function&&n.updateFn(t),n.$parent.timeline=t};if(i.forVideo){var z=document.querySelector(i.forVideo);z.addEventListener("loadedmetadata",function(){var t=function(){u||(n.value=z.currentTime/z.duration),A(),r=window.setTimeout(t,100),n.$apply()};t()}),n.togglePlay=function(t){n.play=t,t===!0?z.play():z.pause()},n.$on("$destroy",function(){a&&t.cancel(a)}),c=function(){return z.duration?(n.value>.99&&(n.value=.99),z.currentTime=z.duration*n.value,z.pause(),n.play=!1,void A()):!1}}p=d3.scale.linear().range([52,w-40]).clamp(!0);var T=d3.behavior.drag().on("dragstart",function(){u=!0}).on("drag",function(){C=p.invert(d3.event.x),S(p.invert(d3.event.x))}).on("dragend",function(){n.value=C,C=!1,u=!1,c()});h.call(T),h.on("click",function(){n.value=p.invert(d3.event.offsetX),c()});for(var M=0;d>M;M++){var j;_.append("circle").attr("class",function(){return"tick-"+M+" tick"}).attr("cx",function(){var t=l/d,n=M+o[1]/t;return j=p(n/d)}).attr("cy",47).attr("r",3),(0===M||M===d-1)&&_.append("text").text(function(){var t=k(p.invert(j));return t.hours12+":00"+t.meridiem}).attr("y",70).attr("x",j).attr("class","label")}v.attr("x1",p(0)),f.attr("x2",p(1)),n.$on("$destroy",function(){window.clearTimeout(r)})}}}]),angular.module("cmapMobilityApp").directive("indicatorGraph",["$stateParams","$timeout","dataCollection","colors",function(t,n,e,i){return{restrict:"E",templateUrl:"components/indicator-graph/indicator-graph.tpl.html",link:function(n){var a=e.retrieve("indicatorData").geoJSON(),r=t.topicId,o=t.indicatorId;n.indicatorData=a[r].indicators[o].indicatorData,n.getColor=function(t,n){return n=n||0,t+"--"+i.get(n)}}}}]),angular.module("cmapMobilityApp").directive("graphDonut",function(){return{restrict:"E",templateUrl:"components/graphs/graph-donut/graph-donut.tpl.html",link:function(t,n,e){var i=1e3,a=e.width,r=a,o=70,s=e.range||100,l=[e.value,s-e.value],c=e.ring||7,p=d3.layout.pie().sort(null).value(function(t){return t}),d=d3.svg.arc().innerRadius(o-parseInt(c)).outerRadius(o),u=d3.select(n[0]).append("svg").attr("width",a).attr("height",r).append("g").attr("transform","translate("+a/2+","+r/2+")");u.selectAll(".graph-donut__metric-label").data([e.label]).enter().append("text").attr("class","graph-donut__metric-label graphstat graphstat__heading graphstat--secondary main-color").text(e.label).attr("transform","translate(0,-90)"),"large"!==e.type&&u.selectAll(".graph-donut__metric-name").data([e.metric]).enter().append("text").attr("class","graph-donut__metric-name graphstat graphstat__figure graphstat--secondary main-color").text(e.metric).attr("transform","translate(0,5)");var g=e.value,h="translate(-5,15)";"large"===e.type&&(g+="%",h="translate(-5,10)"),u.selectAll(".graph-donut__metric-value").data([e.value]).enter().append("text").attr("class","graph-donut__metric-value graphstat graphstat__figure graphstat--primary main-color").text(g).attr("transform",h),t.intro=function(t){if(!t)return!1;var n=p(l);u.selectAll("path").data(n).enter().append("path").attr("class",function(t,n){var e="graph-donut__ring-part";return 0===n&&(e+=" graph-donut__ring-part--main-color"),e}).transition().duration(i).attrTween("d",function(t,e){var i;return 0===e?(i=d3.interpolate(t.startAngle+.1,t.endAngle),function(n){return t.endAngle=i(n),d(t)}):(i=d3.interpolate(n[0].startAngle+.1,n[0].endAngle),function(n){return t.startAngle=i(n),d(t)})})}}}}),angular.module("cmapMobilityApp").directive("graphHorizontalBar",function(){return{restrict:"E",templateUrl:"components/graphs/graph-horizontal-bar/graph-horizontal-bar.tpl.html",link:function(t,n,e){var i=1e3,a=200,r=a,o=8,s=a-20,l=d3.scale.linear().domain([0,100]).range([0,s]),c=d3.select(n[0]).append("svg").attr("width",a).attr("height",r).append("g").attr("transform","translate(20,"+r/2+")");c.append("rect").attr("class","graph-horizontal-bar__bar-bg").attr("width",s).attr("height",o),c.selectAll(".graph-horizontal-bar__bar").data([e.value]).enter().append("rect").attr("class","graph-horizontal-bar__bar main-color").attr("width",0).attr("height",o),c.selectAll(".graph-horizontal-bar__metric-name").data([e.label]).enter().append("text").attr("class","graph-horizontal-bar__metric-name graphstat graphstat__heading graphstat--primary main-color").text(function(){return e.label}).attr("transform","translate(0,-9)");var p=0,d=parseFloat(e.value),u=String(d).split(".");u[1]||(u[1]="0"),c.selectAll(".graph-horizontal-bar__metric-value").data([e.value]).enter().append("text").attr("class","graph-horizontal-bar__metric-value graphstat graphstat__figure graphstat--primary main-color").text(u[0]+".").attr("transform","translate(0,43)").each(function(){p=this.getBBox().width}),c.selectAll(".graph-horizontal-bar__metric-percentage").data([e.value]).enter().append("text").attr("class","graph-horizontal-bar__metric-percentage graphstat graphstat__figure graphstat--primary main-color").text(u[1]+"%").attr("transform",function(){return"translate("+p+",38)"}),t.intro=function(t){return t?void c.selectAll(".graph-horizontal-bar__bar").transition().duration(i).attr("width",function(t){return l(t)}):!1}}}}),angular.module("cmapMobilityApp").directive("graphVerticalBar",function(){return{restrict:"E",templateUrl:"components/graphs/graph-vertical-bar/graph-vertical-bar.tpl.html",link:function(t,n,e){var i=t.$parent.indicatorData.data,a=e.width||704,r=e.height||290,o=e.barWidth||32,s=e.bgLines||6,l=30,c=65,p=90,d=1e3,u=d3.max(i,function(t){return t.value}),g={};g.x=d3.scale.linear().domain([0,i.length-1]).range([l,a-l-o]),g.y=d3.scale.linear().domain([0,u]).range([0,r-p-c]);for(var h=d3.select(n[0]).append("svg").attr("width",a).attr("height",r).append("g"),m=g.y(u)-g.y(0),v=m/(s-1),f=0;s>f;f++)h.append("line").attr("class","graph-vertical-bar__bg-line").attr("x1",0).attr("x2",a).attr("y1",v*f+1+c).attr("y2",v*f+1+c);h.append("line").attr("class","graph-vertical-bar__axis-line").attr("x1",0).attr("x2",a).attr("y1",r-c-g.y(0)).attr("y2",r-c-g.y(0)),h.selectAll("rect").data(i).enter().append("rect").attr("x",function(t,n){return g.x(n)}).attr("y",r-c).attr("width",o).attr("height",0).attr("class","graph-vertical-bar__bar"),h.selectAll("text.graph-vertical-bar__value").data(i).enter().append("text").attr("x",function(t,n){return g.x(n)+o/2}).attr("y",function(t){return r-c-g.y(t.value)-20}).attr("opacity",0).attr("class","graph-vertical-bar__value").text(function(t){return t.value.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}),h.selectAll("text.graph-vertical-bar__label").data(i).enter().append("text").attr("x",function(t,n){return g.x(n)+o/2}).attr("y",function(){return r-p+50}).attr("class","graph-vertical-bar__label").text(function(t){return t.label}),t.intro=function(t){return t?(h.selectAll(".graph-vertical-bar__bar").transition().delay(.3*d).duration(d).attr("height",function(t){return g.y(t.value)}).attr("y",function(t){return r-c-g.y(t.value)}),void h.selectAll("text.graph-vertical-bar__value").transition().delay(.3*d+.7*d).duration(.5*d).attr("opacity",1)):!1}}}}),angular.module("cmapMobilityApp").directive("graphStackedBar",function(){return{restrict:"E",templateUrl:"components/graphs/graph-stacked-bar/graph-stacked-bar.tpl.html",link:function(t,n,e){var i=1e3,a=e.width||800,r=30,o=8,s=a-400,l=d3.select(n[0]).append("svg").attr("width",a).attr("height",r).append("g"),c=s*(e.value/e.max);l.append("rect").attr("x",200).attr("y",(r-o)/2).attr("width",s).attr("height",o).attr("class","graph-stacked-bar__bar"),l.append("rect").attr("x",200).attr("y",(r-o)/2).attr("width",0).attr("height",o).attr("class","graph-stacked-bar__bar graph-stacked-bar__bar--main"),l.append("text").attr("x",180).attr("y",(r-o)/2+8).attr("class","graph-stacked-bar__label").text(e.label);var p=String(e.value).split(".");p[1]||(p[1]=0),l.append("text").attr("x",a-200+20).attr("y",(r-o)/2+12).attr("class","graph-stacked-bar__value").text(p[0]+"."),l.append("text").attr("x",a-200+40).attr("y",(r-o)/2+9).attr("class","graph-stacked-bar__value graph-stacked-bar__value--small").text(p[1]),l.append("text").attr("x",a-200+68).attr("y",(r-o)/2+1.5).attr("class","graph-stacked-bar__value graph-stacked-bar__value--units").text(e.units),t.intro=function(t){return t?void l.selectAll(".graph-stacked-bar__bar--main").transition().duration(i).attr("width",c):!1}}}}),angular.module("cmapMobilityApp").directive("graphLine",function(){return{restrict:"E",templateUrl:"components/graphs/graph-line/graph-line.tpl.html",link:function(t,n,e){var i=t.$parent.indicatorData,a=e.width||680,r=e.height,o=+e.split||i.points.length,s=50,l=1e3,c={},p=i.points;i.points2&&(p=p.concat(i.points2)),c.x=d3.extent(p,function(t){return t.year}),c.y=d3.extent(p,function(t){return t.value});var d=[40,a-60];i.points2&&(d=[60,a-75]);var u=[0,c.y[1]];i.points2&&(u=[60,85]);var g={};g.x=d3.scale.linear().domain([c.x[0],c.x[1]]).range(d),g.y=d3.scale.linear().domain(u).range([r,s]);var h=d3.svg.line().x(function(t){return g.x(t.year)}).y(function(t){return g.y(t.value)}).interpolate("linear"),m=d3.svg.line().x(function(t){return g.x(t.year)}).y(function(){return r-30}).interpolate("linear"),v=d3.select(n[0]).append("svg").attr("width",a).attr("height",r).append("g");v.selectAll(".bg-line").data(i.points).enter().append("line").attr("x1",function(t){return g.x(t.year)}).attr("x2",function(t){return g.x(t.year)}).attr("y1",s).attr("y2",r-30).attr("class","bg-line"),v.append("path").datum(i.points.slice(0,o+1)).attr("class","main-line anim-line").attr("d",m),v.append("path").datum(i.points.slice(o,i.points.length)).attr("class","second-line anim-line").attr("d",m),i.points2&&v.append("path").datum(i.points2).attr("class","dual-line anim-line").attr("d",m),v.selectAll(".points").data(i.points).enter().append("circle").attr("cx",function(t){return g.x(t.year)}).attr("cy",r-30).attr("r",4).attr("class",function(t,n){return n>o-1?"points second":"points"}),i.points2&&v.selectAll(".points.second").data(i.points2).enter().append("circle").attr("cx",function(t){return g.x(t.year)}).attr("cy",r-30).attr("r",4).attr("class","points second"),v.selectAll(".label").data(i.points).enter().append("text").attr("x",function(t){return g.x(t.year)}).attr("y",r-12).text(function(t){return t.label}).attr("opacity",0).attr("class","label");var f=function(t,n,e){v.selectAll(".value.large."+n).data(t).enter().append("text").attr("x",function(t){return g.x(t.year)+2}).attr("y",function(t){return g.y(t.value)-e}).text(function(t){return String(t.value).split(".")[0]+"."}).attr("opacity",0).attr("class",function(t,e){var i=n+" value large";return e>o-1&&(i+=" second"),i+=" value-"+e}),v.selectAll(".value.small."+n).data(t).enter().append("text").attr("x",function(t){return g.x(t.year)+2.5}).attr("y",function(t){return g.y(t.value)-3-e}).text(function(t){var n=String(t.value).split(".")[1];return n||(n="0"),n+"%"}).attr("opacity",0).attr("class",function(t,e){var i=n+" value small";return e>o-1&&(i+=" second"),i+=" value-"+e})};i.points2?(f(i.points,"first-line",12),f(i.points2,"second-line",-36)):f(i.points,"first-line",16),i.points2&&v.selectAll(".graph-label").data(i.labels).enter().append("text").attr("x",function(){return g.x(2030)}).attr("y",function(t,n){return 0===n?g.y(75.5)+32:g.y(79.5)-18}).text(function(t){return t}).attr("opacity",0).attr("class",function(t,n){return 1===n?"graph-label":"graph-label second"});var _=!1;t.intro=function(t){return!t||_?!1:(v.selectAll(".anim-line").transition().duration(l).attr("d",h),v.selectAll("circle").transition().duration(l).attr("cy",function(t){return g.y(t.value)}),v.selectAll("text.value, text.graph-label, .label").transition().delay(.9*l).duration(.5*l).attr("opacity",1),void(_=!0))}}}}),angular.module("cmapMobilityApp").directive("graphTimeline",function(){return{restrict:"E",templateUrl:"components/graphs/graph-timeline/graph-timeline.tpl.html",link:function(t,n,e){for(var i=t.$parent.indicatorData.data,a=e.width||1e3,r=e.height||225,o=e.radius||4,s=45,l=1e3,c=d3.max(i,function(t){return t.value}),p=d3.scale.linear().domain([0,c]).range([s,a-s]),d=p(1)-p(0)-o,u=d3.select(n[0]).append("svg").attr("width",a).attr("height",r).append("g"),g=0;c>g;g++)u.append("circle").attr("cx",p(g)).attr("cy",115).attr("r",o).attr("opacity",0).attr("class","graph-timeline__circle");u.selectAll(".graph-timeline__value").data(i).enter().append("text").attr("x",function(t){return p(t.value-1)+d}).attr("y",165).attr("opacity",0).attr("class","graph-timeline__value").text(function(t){return t.value}).attr("text-anchor",function(t){return t.align}),u.selectAll(".graph-timeline__label-group").data(i).enter().append("g").attr("class","graph-timeline__label-group").attr("transform",function(t){var n=p(t.value-1),e=95;return"rotate(45, "+n+" "+e+")"}).each(function(t){d3.select(this).append("text").attr("x",function(t){return p(t.value-1)}).attr("y",95).attr("opacity",0).attr("class","graph-timeline__label").text(function(){return t.label})}),u.selectAll(".graph-timeline__line").data(i).enter().append("line").attr("class","graph-timeline__line").attr("x1",function(t){return p(t.value-1)+d-o/2}).attr("x2",function(t){return p(t.value-1)+d-o/2}).attr("y1",100).attr("y2",135).attr("opacity",0);var h=!1;t.intro=function(t){if(!t||h)return!1;var n=function(t){u.selectAll(t).attr("opacity",0).transition().delay(function(t,n){return.3*l*n}).duration(l).attr("opacity",1)};n(".graph-timeline__line"),n(".graph-timeline__label"),n(".graph-timeline__value"),u.selectAll(".graph-timeline__circle").attr("opacity",0).transition().delay(function(t,n){return l/c*n}).duration(l).attr("opacity",1),h=!0}}}}),angular.module("cmapMobilityApp").directive("mapControls",function(){return{restrict:"E",scope:{styleType:"&",content:"&",options:"&",mapControls:"="},templateUrl:"components/maps/map-controls/map-controls.tpl.html",link:function(t){t.mapControls.toggleContent=!0,t.mapControls.toggleHover=function(n){t.mapControls.isHovered=n},t.mapControls.toggleSelected=function(n){t.mapControls.isSelected=n},setTimeout(function(){n()},0),t.toggle={};var n=function(){if(void 0!==t.options)for(var n in t.options.groups)t.toggle[n]=!1};t.toLining=function(t){return t.replace(/(\d+)/g,'<span class="lining-figure">$1</span>')}}}}),angular.module("cmapMobilityApp").directive("fallback",function(){return{restrict:"E",templateUrl:"components/fallback/fallback.tpl.html",link:function(t,n,e){t.src=e.src,t.img=e.src+".png",t.overlay=e.overlay||!1,t.showOverlay=t.overlay;var i=function(){t.showOverlay=!0,t.$apply()},a=function(){if(e.ratio){var t=n[0].clientWidth,i=t*e.ratio;n.css("height",i+"px"),n.parent().css("height",i+"px").css("min-height",0)}};a(),window.addEventListener("resize",a,!1),t.play=function(){var e=n[0].querySelector("video");t.showOverlay=!1,e.play(),e.addEventListener("pause",i,!1)},t.$on("$destroy",function(){var t=n[0].querySelector("video");t.removeEventListener("pause",i,!1),window.removeEventListener("resize",a,!1)})}}}),angular.module("cmapMobilityApp").directive("navigationArrow",["$rootScope","$state","$stateParams","sharedDataFactory",function(t,n,e,i){return{restrict:"E",templateUrl:"components/navigation-arrow/navigation-arrow.tpl.html",link:function(a,r,o){var s,l=i.getData(),c=[],p=0,d=function(t,n){c.push(t),n&&(t.parent=n),(e.indicatorId&&t.url===e.indicatorId||!e.indicatorId&&t.url===e.topicId)&&(s=p),e.stepId&&t.url===e.stepId&&(s=p),p++,t.indicators&&u(t.indicators,t.url),t.introduction&&u(t.introduction,t.url)},u=function(t,n){for(var e=0;e<t.length;e++)d(t[e],n)},g=function(t){for(p=0;p<c.length;p++)(t.indicatorId&&c[p].url===t.indicatorId||!t.indicatorId&&c[p].url===t.topicId)&&(s=p,h()),t.stepId&&c[p].url===t.stepId&&(s=p)},h=function(){var t=s-1;t>0?(a.previous=c[t],a.first=!1):(a.previous=c[t],a.first=!0);var n=s+1;n<c.length?(a.next=c[n],a.last=!1):a.last=!0};u(l.introduction),u(l.topic),g(e),h(),a.$root.$on("$viewContentLoaded",function(){g(e),h()}),(o.update||""===o.update)&&t.$on("$stateChangeStart",function(t,n,e){g(e),h()}),a.navigate=function(t){switch(t){case"previous":"splash"===a.previous.url?n.go("splash"):"splash"===a.previous.parent?n.go("introduction",{stepId:a.previous.url}):a.previous.parent?n.go("topic.indicator",{topicId:a.previous.parent,indicatorId:a.previous.url}):n.go("topic",{topicId:a.previous.url});break;case"next":"splash"===a.next.parent?n.go("introduction",{stepId:a.next.url}):a.next.parent?n.go("topic.indicator",{topicId:a.next.parent,indicatorId:a.next.url}):n.go("topic",{topicId:a.next.url})}}}}}]),angular.module("cmapMobilityApp").directive("navigationArrowSplash",function(){return{restrict:"E",templateUrl:"components/navigation-arrow-splash/navigation-arrow-splash.tpl.html",link:function(){}}}),angular.module("cmapMobilityApp").directive("videoLoader",function(){return{restrict:"E",templateUrl:"components/video-loader/video-loader.tpl.html",link:function(t,n,e){var i=document.createElement("video");t.videoSupport=!0,e.$observe("poster",function(n){t.image="url("+n+")"}),e.$observe("src",function(a){t.image||(t.image="url("+a+".png)");var r=""===e.loop?!0:!1,o=""===e.autoplay?!0:!1,s=""===e.controls?!0:!1;i.canPlayType("video/mp4")?a+=".mp4":i.canPlayType("video/ogg")?a+=".ogv":t.videoSupport=!1,t.videoSupport&&(i.autoplay=o,i.loop=r,i.controls=s,i.src=a,e.poster&&(i.poster=e.poster),i.addEventListener("loadeddata",function(){n.addClass("loaded"),t.$apply()},!1),i.addEventListener("play",function(){t.isPlaying=!0,t.$apply()},!1),i.addEventListener("ended",function(){t.isPlaying=!1,t.$apply()},!1),n.prepend(i))}),t.togglePlay=function(t){t?i.play():i.pause()}}}}),angular.module("cmapMobilityApp").directive("notification",["$timeout","$window","webglTest",function(t,n,e){return{restrict:"E",templateUrl:"components/notification/notification.tpl.html",link:function(i){i.isVisible="";var a=!0,r=[];e.check()&&a?r.push(!0):(r.push(!1),console.warn("You browser does not support WebGL"));var o=angular.element(n)[0].innerWidth;o>1024?r.push(!0):(r.push(!1),console.warn("You browser resolution is too small"));var s=!!window.opera||/opera|opr/i.test(navigator.userAgent);s?(r.push(!1),console.warn("This website is not optimized for this browser")):r.push(!0);
var l=document.all&&!window.atob;l?(r.push(!1),console.warn("This website is not optimized for this browser")):r.push(!0);for(var c=r.length-1;c>=0;c--)a=r[c]&&a?!0:!1;a||t(function(){i.isVisible="warn"},2e3),i.dismiss=function(){i.isVisible=""},i.$on("toggleNotification",function(t,n){i.isVisible=n.isVisible})}}}]),angular.module("cmapMobilityApp").directive("popover",function(){return{restrict:"E",scope:{contentText:"="},templateUrl:"components/popover/popover.tpl.html",link:function(t){t.expanded=!1}}}),angular.module("cmapMobilityApp").directive("inview",["inviewService","$parse",function(t,n){return{restrict:"A",link:function(e,i,a){var r=n(a.inview),o=t.add(i,function(t){r(e)(t)});window.setTimeout(function(){t.recalculate()},0),e.$on("$destroy",function(){t.remove(o)})}}}]),angular.module("cmapMobilityApp").directive("shadow",["$stateParams",function(t){return{restrict:"A",link:function(n,e,i){switch(e.addClass("section__shadow"),i.shadow){case"0":switch(t.indicatorId){case"congestion":e.addClass("section__shadow--light");break;case"ride-quality":e.addClass("section__shadow--dark")}break;case"1":switch(e.addClass("section__shadow--dark"),t.indicatorId){case"access-to-transit":case"maintenance":case"create-projects":e.removeClass("section__shadow--dark")}}}}}]),angular.module("cmapMobilityApp").directive("mapCongestion",["dataCollection","renderService",function(t,n){return{restrict:"E",templateUrl:"components/maps/congestion/congestion.tpl.html",link:function(e,i){n.startRendering();var a=document.createElement("video"),r=navigator.userAgent.search("Firefox")?"ogg":"mp4";a.autoplay=!0,a.loop=!0,a.controls=!1,a.src="data/maps/congestion/congestion."+r,a.className="congestion-video",i.append(a),e.video=!0,e.timeline={};var o=new CMAP.classes.Projection([-87.6298,41.87811],15),s=new CMAP.classes.World(i[0],o,["tiltShift"],900);s.FX.setBlur(0,.5,2.25);var l=t.retrieve("mapdata").geoJSON(),c=t.retrieve("congestionRoads").setProjection(o).topoJSON("here_traffic_merge_simplofy20ft-supermerged"),p=t.retrieve("grid"),d=t.retrieve("congestionHighlights").setProjection(o),u=new CMAP.classes.Layer3D(s),g=new CMAP.classes.Layer3D(s),h=new CMAP.classes.Layer3D(s);u.data(c,0).options({video:a,offsetX:2,width:1,speed:.33}).build(CMAP.build.tubes3DVideo),h.data(p,-10).options({colors:["#CCCCCC","#7cd39b","#00c4ff"]}).build(CMAP.build.pointGrid),g.data(d,40).options({click:function(){}}).build(CMAP.build.highlights),s.camera.gotoGeo(-87.75,40.75,1500).lookAtGeo(-87.75,41.5,0);var m=[{lat:-87.75,lon:41.2,height:400},{lat:-87.75,lon:41.5,height:200}];a.addEventListener("loadeddata",function(){n.endRendering(),s.start(),s.camera.animateTo(m[0],m[1])}),e.points=g.action("getPoints"),e.currentHighlight=!1,e.updateFn=function(t){var n=l.roads.indicators.congestion.mapData,i=Math.round((n.avgSpeed.length-1)*t.range);e.avgSpeed=parseFloat(n.avgSpeed[i]).toFixed(2)},e.highlightPoint=function(t){if(t.id&&e.currentHighlight.id!==t.id){e.currentHighlight=t,t.pos.z=0;var n={lat:t.highlight[0],lon:t.highlight[1],height:0},i={lat:t.highlight[0],lon:t.highlight[1]+1,height:175};s.camera.interpolateTo(i,n,150,!0),g.action("fadeOut"),g.action("highlightPoint",t.id),s.FX.setBlur(10,.5,1.9,!0)}else e.currentHighlight=!1,s.FX.setBlur(0,.5,2.25,!0),s.camera.animateTo(m[0],m[1]),g.action("fadeIn"),g.action("highlightPoint",null)},e.resetView=function(){e.highlightPoint(!1)},e.mapControls.toggleContent=!0,e.toggleRender=function(t){return n.done?void(t?s.start():s.stop()):!1},e.$on("$destroy",function(){s.destroy(),s=void 0,u.destroy(),g.destroy(),h.destroy()}),e.toLining=function(t){return t.replace(/(\d+)/g,'<span class="lining-figure">$1</span>')}}}}]),angular.module("cmapMobilityApp").directive("mapCongestionFallback",function(){return{restrict:"E",templateUrl:"components/maps/congestion-fallback/congestion-fallback.tpl.html"}}),angular.module("cmapMobilityApp").directive("mapLandingPage",["dataCollection","renderService",function(t,n){return{restrict:"E",templateUrl:"components/maps/landing-page/landing-page.tpl.html",link:function(e,i){n.wait(),e.timeline={};var a=new CMAP.classes.Projection([-87.6298,41.87811],15),r=new CMAP.classes.World(i[0],a,["tiltShift"]);r.FX.setBackground("#FFFFFF"),r.scene.fog=new THREE.Fog(16777215,0,2600);var o=t.retrieve("roads").setProjection(a).topoJSON("HWY2013_simplified"),s=t.retrieve("railLinesLowDetail").setProjection(a).topoJSON("railnetwork_cleaned"),l=t.retrieve("satellite").setProjection(a),c=t.retrieve("homeHighlights").setProjection(a),p=new CMAP.classes.Layer3D(r),d=new CMAP.classes.Layer3D(r),u=new CMAP.classes.Layer3D(r),g=new CMAP.classes.Layer3D(r),h=.2,m=.7;p.data(o,5).options({color:new THREE.Color("#FFFFFF"),hover:new THREE.Color("#FFCE00"),width:m,quality:h,opacity:.6}).build(CMAP.build.tubesColor),d.data(s,5).options({color:new THREE.Color("#FFFFFF"),hover:new THREE.Color("#0ABAEE"),width:m,quality:h,opacity:.6}).build(CMAP.build.tubesColor),u.data(c,40).options({click:function(){}}).build(CMAP.build.highlights),g.data(l,0).build(CMAP.build.satellite),r.camera.gotoGeo(-87.6298,41.87811,300).lookAtGeo(-88.13551,42.24003,100),r.camera.flyAround({lat:-88.088554,lon:41.839706},650,400),window.setTimeout(function(){r.start(),n.finished()},0),e.highlight=function(t){switch(t){case"rails":u.action("highlight"),d.action("highlight"),p.action("lowlight");break;case"roads":u.action("highlight"),d.action("lowlight"),p.action("highlight");break;case"none":d.action("resetHighlight"),p.action("resetHighlight"),u.action("resetHighlight")}};var v=new CMAP.classes.Compass(r);v.updateElement(document.querySelector(".compass .needle")),e.$on("$destroy",function(){r.destroy(),v.destroy(),r=void 0,a=void 0,u.destroy(),p.destroy(),d.destroy()})}}}]),angular.module("cmapMobilityApp").directive("ridership",["$q","dataCollection","$window","$timeout",function(t,n,e,i){return{restrict:"E",templateUrl:"components/maps/ridership/ridership.tpl.html",link:function(t){t.content={head:[{title:"CTA boardings per weekday",figure:"726,459"},{title:"METRA boardings per weekday",figure:"267,913"}],options:{title:"Click to see boardings by train line and station"},toggler:{title:"Click to show"}};var a=n.retrieve("mapdata"),r=a.geoJSON(),o=n.retrieve("counties_simplified"),s=o.geoJSON(),l=n.retrieve("ctaLines"),c=l.topoJSON("ctaraillines_cta_201303").geoJSON(),p=n.retrieve("metraLines"),d=p.topoJSON("metralines_rta_201303").geoJSON(),u=n.retrieve("ctaStations"),g=u.topoJSON("cta_avg_weekdayboard_2001thru2013").geoJSON(),h=n.retrieve("metraStations"),m=h.topoJSON("metra_weekdayboardings_1983thru2014").geoJSON(),v={projection:{center:[-88.08889,41.877537],zoom:2e4,offset:{x:-100,y:15}},mapping:{minRidership:2500,maxRidership:234232,minLineW:1,maxLineW:10},centerCircles:{centerPoint:[-87.63296,41.893887],centerRadiuses:[280,225,150,90],centerGeoRadiuses:[[-87.78496569,42.03505022],[-87.65920228,41.99366426],[-87.65338049,41.93975075],[-87.64917727,41.91065458]],labels:[{label:"12.5 miles",geo:[-87.78496569,42.03505022],offset:{x:-35,y:5},width:55,height:16},{label:"7 miles",geo:[-87.65920228,41.99366426],offset:{x:-23,y:5},width:38,height:16},{label:"3.3 miles",geo:[-87.65338049,41.93975075],offset:{x:-11,y:5},width:48,height:16},{label:"1.5 miles",geo:[-87.64917727,41.91065458],offset:{x:-3,y:5},width:48,height:16},{label:"center",geo:[-87.63296,41.893887],offset:{x:15,y:5},width:40,height:16}],padding_leftright:5,padding_topbottom:3,font_size:14},warp:{radius:400,offset:{x:5,y:0},distort:10}},f={innerSize:3,outerSize:5,outerLineWidth:1,outerDefOpac:.35,outerHovOpac:.75,minRdrs:0,maxRdrs:19260,minCircleR:5,maxCircleR:15},_="#5787a9",y="rgb(65,65,65)",b="rgb(120,120,120)";t.options=r.transit.indicators["weekday-trips"].mapData,t.highlightCSS=0,t.highlightContent="";var x=angular.element(e),w=function(n,e,a){function o(t){var n=.2,e=1,i=[v.projection.offset.x>0?-v.projection.offset.x:Math.abs(v.projection.offset.x),v.projection.offset.y>0?-v.projection.offset.y:Math.abs(v.projection.offset.y)],a=T.scaleExtent(),r=T.translate(),o=[],s=[],c={x:r[0],y:r[1],k:T.scale()};e="zoom_in"===t?T.scale()*(1+1*n):T.scale()*(1+-1*n),e<a[0]?e=a[0]:e>a[1]&&(e=a[1]),o=[(i[0]-c.x)/c.k,(i[1]-c.y)/c.k],c.k=e,s=[o[0]*c.k+c.x,o[1]*c.k+c.y],c.x+=i[0]-s[0],c.y+=i[1]-s[1],T.scale(c.k),T.translate([c.x,c.y]),l()}function l(){L=T.scale(),O=T.translate(),O[0]<-(M*L)/2?(O[0]=-(M*L)/2,T.translate(O)):O[0]>M*L/2&&(O[0]=M*L/2,T.translate(O)),O[1]<-(j*L)/2?(O[1]=-(j*L)/2,T.translate(O)):O[1]>j*L/2&&(O[1]=j*L/2,T.translate(O)),W.attr("transform","translate("+O+")scale("+L+")"),$!==L&&S(),$=L,P=!0}function p(t){var n=Q(t);return{x:n[0],y:n[1]}}function u(){W.append("defs").append("clipPath").attr("id","countiesMask").attr("width",M).attr("height",j).append("path").data(s.features).attr("d",function(t){return A(t.geometry)}).attr("transform",function(){var t=p([v.centerCircles.centerPoint[0],v.centerCircles.centerPoint[1]]),n=p([v.projection.center[0],v.projection.center[1]]),e=t.x-n.x,i=t.y-n.y;return"translate("+-e+","+-i+")"}),J.selectAll(".circle").data(v.centerCircles.centerGeoRadiuses).enter().append("circle").attr("class","circle").attr("transform",function(){var t=p(v.centerCircles.centerPoint);return"translate("+t.x+","+t.y+")"}).attr("r",function(t){var n=p(v.centerCircles.centerPoint),e=p(t),i=tn(e),a=Math.sqrt((n.x-i.x)*(n.x-i.x)+(n.y-i.y)*(n.y-i.y));return a}).style("clip-path","url(#countiesMask)");var n=Y.selectAll(".label").data(v.centerCircles.labels).enter().append("g").attr("class","label").attr("transform",function(t){var n=p(v.centerCircles.centerPoint),e=p(t.geo),i=tn(e),a=Math.sqrt((n.x-i.x)*(n.x-i.x)+(n.y-i.y)*(n.y-i.y));return"center"===t.label&&(a=0),"translate("+(n.x+t.offset.x)+","+(n.y+t.offset.y-a)+")"});n.append("rect").attr("height",function(t){return t.height+2*v.centerCircles.padding_topbottom}).attr("width",function(t){return t.width+2*v.centerCircles.padding_leftright}).attr("transform",function(t){return"translate("+-v.centerCircles.padding_leftright+","+-(t.height/3*2+v.centerCircles.padding_topbottom+1)+")"}),n.append("text").text(function(t){return t.label}),G.selectAll(".county").data(s.features).enter().append("path").attr("class","county").attr("d",function(t){return A(t.geometry)}),Z.selectAll(".rail.cta").data(c.features).enter().append("path").attr("class","rail cta").attr("d",function(t){return A(t.geometry)}),Z.selectAll(".rail.metra").data(d.features).enter().append("path").attr("class","rail metra").attr("d",function(t){return A(t.geometry)});var e=K.selectAll(".station.metra").data(m.features).enter().append("g").attr("class","station metra").attr("transform",function(t){t.properties.YR__2014>f.maxRdrs&&(f.maxRdrs=t.properties.YR__2014);var n=p(t.geometry.coordinates),e=tn(n);return"translate("+e.x+","+e.y+")"});e.append("circle").attr("class","outer-circle").attr("r",function(){return f.outerSize/L}).style("fill","white").style("stroke",_),e.append("circle").attr("class","inner-circle").attr("r",f.innerSize/L),e.on("mouseover",function(n){if(H!==n.properties.STATION_ID&&!P){var e=0;H=n.properties.STATION_ID,h(),D=d3.select(this)[0][0],D.parentNode.appendChild(D),E=d3.select(this);var i=p(n.geometry.coordinates),a=tn(i);a.x=a.x*L+O[0]+(M/2+v.projection.offset.x),a.y=a.y*L+O[1]+(j/2+v.projection.offset.y),z?(E.select(".outer-circle").transition().style("opacity",f.outerHovOpac),e="undefined"!=typeof n.properties.YR__2014&&"--"!==n.properties.YR__2014?an(n.properties.YR__2014)/L:f.minCircleR/L):(E.select(".inner-circle").transition().duration(400).attr("r",function(){return f.outerSize/L}),e=0),t.setHighlight(!0,a,n.properties,e)}});var i=K.selectAll(".station.cta").data(g.features).enter().append("g").attr("class","station cta").attr("transform",function(t){t.properties.YR_2013>f.maxRdrs&&(f.maxRdrs=t.properties.YR_2013);var n=p(t.geometry.coordinates),e=tn(n);return"translate("+e.x+","+e.y+")"});i.append("circle").attr("class","outer-circle").attr("r",f.outerSize/L).style("fill","white").style("stroke",_),i.append("circle").attr("class","inner-circle").attr("r",f.innerSize/L),i.on("mouseover",function(n){if(H!==n.properties.STATION_ID&&!P){var e=0;H=n.properties.STATION_ID,h(),D=d3.select(this)[0][0],D.parentNode.appendChild(D),E=d3.select(this);var i=p(n.geometry.coordinates),a=tn(i);a.x=a.x*L+O[0]+(M/2+v.projection.offset.x),a.y=a.y*L+O[1]+(j/2+v.projection.offset.y),z?(E.select(".outer-circle").transition().style("opacity",f.outerHovOpac),e="undefined"!=typeof n.properties.YR_2013&&"--"!==n.properties.YR__2014?an(n.properties.YR_2013)/L:f.minCircleR/L):(E.select(".inner-circle").transition().duration(400).attr("r",function(){return f.outerSize/L}),e=0),t.setHighlight(!0,a,n.properties,e)}}),V.on("click",function(){H=-1,h(),w()}).on("mouseover",function(){H=-1,h()}),w()}function h(){"undefined"!=typeof D&&(z?E.select(".outer-circle").transition().style("opacity",f.outerDefOpac):E.select(".inner-circle").transition().duration(400).attr("r",function(){return f.innerSize/L})),t.setHighlight(!1,0,"",0)}function w(){en.domain([v.mapping.minRidership,v.mapping.maxRidership]).range([v.mapping.minLineW,v.mapping.maxLineW]),an.domain([f.minRdrs,f.maxRdrs]).range([f.minCircleR,f.maxCircleR]),K.selectAll(".station.metra").selectAll(".outer-circle").transition().duration(400).attr("r",function(t){return z?"undefined"!=typeof t.properties.YR__2014&&"--"!==t.properties.YR__2014?an(t.properties.YR__2014)/L:f.minCircleR/L:f.outerSize/L}).style("fill",function(){return z?_:"white"}).style("stroke-width",f.outerLineWidth/L).style("opacity",function(){return z?f.outerDefOpac:1}),K.selectAll(".station.cta").selectAll(".outer-circle").transition().duration(400).attr("r",function(t){return z?"undefined"!=typeof t.properties.YR_2013&&"--"!==t.properties.YR__2014?an(t.properties.YR_2013)/L:f.minCircleR/L:f.outerSize/L}).style("fill",function(){return z?_:"white"}).style("stroke-width",f.outerLineWidth/L).style("opacity",function(){return z?f.outerDefOpac:1}),Z.selectAll(".rail.metra").transition().duration(300).style("stroke",function(t){if(-1===q)return y;for(var n=0;n<U.lines[q].legends.length;n++)if(t.properties.LINES===U.lines[q].legends[n])return U.lines[q].color;return b}).style("stroke-width",function(t){if(-1===q)return 1/L;for(var n=0;n<U.lines[q].legends.length;n++)if(t.properties.LINES===U.lines[q].legends[n]){var e=en(U.lines[q].ridership2013);return e/L}return 1/L}),Z.selectAll(".rail.cta").transition().duration(300).style("stroke",function(t){if(-1===q)return y;for(var n=0;n<U.lines[q].legends.length;n++)if(t.properties.ALT_LEGEND===U.lines[q].legends[n])return U.lines[q].color;return b}).style("stroke-width",function(t){if(-1===q)return 1/L;for(var n=0;n<U.lines[q].legends.length;n++)if(t.properties.ALT_LEGEND===U.lines[q].legends[n]){var e=en(U.lines[q].ridership2013);return e/L}return 1/L})}function C(t,n){(t!==R||n!==N)&&(t>1024?k(t,n):k(1024,n)),R=t,N=n}function k(t,n){B.attr("width",t).attr("height",n),F.attr("transform",function(){return"translate("+(t/2+v.projection.offset.x)+","+(n/2+v.projection.offset.y)+")"}),V.attr("width",t).attr("height",n).attr("transform",function(){return"translate("+-(t/2+v.projection.offset.x)+","+-(n/2+v.projection.offset.y)+")"}),M=t,j=n}function S(){Z.selectAll(".rail.cta").style("stroke-width",function(t){if(-1===q)return 1/L;for(var n=0;n<U.lines[q].legends.length;n++)if(t.properties.ALT_LEGEND===U.lines[q].legends[n]){var e=en(U.lines[q].ridership2013);return e/L}return 1/L}),Z.selectAll(".rail.metra").style("stroke-width",function(t){if(-1===q)return 1/L;for(var n=0;n<U.lines[q].legends.length;n++)if(t.properties.LINES===U.lines[q].legends[n]){var e=en(U.lines[q].ridership2013);return e/L}return 1/L}),K.selectAll(".station").selectAll(".inner-circle").attr("r",f.innerSize/L),K.selectAll(".station.cta").selectAll(".outer-circle").attr("r",function(t){return z?"undefined"!=typeof t.properties.YR_2013&&"--"!==t.properties.YR__2014?an(t.properties.YR_2013)/L:f.minCircleR/L:f.outerSize/L}).style("stroke-width",f.outerLineWidth/L),K.selectAll(".station.metra").selectAll(".outer-circle").attr("r",function(t){return z?"undefined"!=typeof t.properties.YR__2014&&"--"!==t.properties.YR__2014?an(t.properties.YR__2014)/L:f.minCircleR:f.outerSize/L}).style("stroke-width",f.outerLineWidth/L),Y.selectAll(".label").select("text").attr("transform","scale("+1/L+","+1/L+")"),Y.selectAll(".label").select("rect").attr("transform",function(t){return"translate("+-(v.centerCircles.padding_leftright/L)+","+-(t.height/3*2+v.centerCircles.padding_topbottom+1)/L+")scale("+1/L+","+1/L+")"})}function A(t){if("Polygon"===t.type){var n="";return t.coordinates.forEach(function(t){t.forEach(function(t,e){var i=p([t[0],t[1]]),a=tn(i);0===e&&(n="M"+a.x+","+a.y),n=n+"L"+a.x+","+a.y})}),n+"Z"}if("LineString"===t.type){var e="";return t.coordinates.forEach(function(t,n){var i=p([t[0],t[1]]),a=tn(i);0===n&&(e="M"+a.x+","+a.y),e=e+"L"+a.x+","+a.y}),e}}var z=!1;t.mapControls.fullSize=!1;var T=d3.behavior.zoom().scale(1).scaleExtent([1,20]).on("zoom",l).on("zoomend",function(){P=!1}),M=e,j=a,I=n+"__d3",R=-1,N=-1,L=1,$=L,O=[];O[0]=0,O[1]=0;var D,E,P=!1,H=-1,q=-1,B=d3.select(I).select("svg").attr("width",M).attr("height",j).call(T).on("dblclick.zoom",null).on("mousewheel.zoom",null).on("DOMMouseScroll.zoom",null).on("wheel.zoom",null),F=B.append("g").attr("class","center").attr("width",M).attr("height",j).attr("transform",function(){return"translate("+(M/2+v.projection.offset.x)+","+(j/2+v.projection.offset.y)+")"}),W=F.append("g").attr("class","world_d3").attr("width",M).attr("height",j),U=r.transit.indicators["weekday-trips"].mapData,G=W.append("g").attr("class","layer-counties").attr("width",M).attr("height",j),J=W.append("g").attr("class","layer-circles").attr("width",M).attr("height",j),Y=W.append("g").attr("class","layer-labels").attr("width",M).attr("height",j),V=W.append("rect").attr("class","layer-deselector").attr("width",M).attr("height",j).attr("transform",function(){return"translate("+-(M/2+v.projection.offset.x)+","+-(j/2+v.projection.offset.y)+")"}),Z=W.append("g").attr("class","layer-lines").attr("width",M).attr("height",j),K=W.append("g").attr("class","layer-stations").attr("width",M).attr("height",j),X=v.projection.zoom/800*j,Q=d3.geo.mercator().scale(X).translate([0,0]).center(v.projection.center),tn=d3.fisheye.circular().radius(v.warp.radius).distortion(v.warp.distort),nn=p(v.centerCircles.centerPoint);tn.focus([nn.x+v.warp.offset.x,nn.y+v.warp.offset.y]);var en=d3.scale.sqrt(),an=d3.scale.sqrt();return t.mapControls.setFocus=function(n){q===n&&(n=-1),q=n,t.mapControls.currentSelectedLine=q,w()},t.mapControls.setFullSize=function(){z=z?!1:!0,t.mapControls.fullSize=z,H=-1,h(),w()},t.setHighlight=function(n,e,a,r){var o=200,s=160,l=365;i(function(){n?(l=d3.select(".section.section--white.intro.ng-scope")[0][0].offsetHeight,e.x<o?(t.highlightClass="map-highlight--flip-right",e.x+=r):e.x>M-o?(t.highlightClass="map-highlight--flip-left",e.x-=r):e.y<s+Math.max(x[0].scrollY-l,0)?(t.highlightClass="map-highlight--flip-bottom",e.y+=r):(t.highlightClass="",e.y-=r),t.highlightCSS={left:e.x+"px",top:e.y+"px",visibility:"visible"},"undefined"!=typeof a.YR_2013?(a.rdrShip=Math.round(a.YR_2013),a.rdrShipYR=2013,t.highlightContent=a):(a.rdrShip=Math.round(a.YR__2014),a.rdrShipYR=2014,t.highlightContent=a)):t.highlightCSS={visibility:"hidden"}})},t.mapControls.zoomIn=function(){o("zoom_in"),P=!1},t.mapControls.zoomOut=function(){o("zoom_out"),P=!1},{init:function(){u()},checkWindowSize:function(t,n){C(t,n)}}},C=new w("#ridership",Math.max(x[0].innerWidth,1024),900);C.init();var k=function(){var t=x[0].innerWidth;C.checkWindowSize(t,900)};x.on("resize",k),t.$on("$destroy",function(){x.off("resize",k)})}}}]),angular.module("cmapMobilityApp").directive("crossingdelay",["$q","dataCollection","$window","$timeout",function(t,n,e,i){return{restrict:"E",templateUrl:"components/maps/crossingdelay/crossingdelay.tpl.html",link:function(t){t.activeRadio={0:!1},t.toggleActiveRadio=function(n){t.activeRadio[n]=!t.activeRadio[n]},t.mapControls.toggleContent=!0,t.content={head:[{title:"regional weekday totals, 2011"},{title:"delay hours",figure:"7,817"},{title:"rail crossings",figure:"1,468"},{title:"delayed motorists",figure:"384,037"}],options:{title:"Top 10 average delay (hours /day)"},toggler:{title:"Click to show"}},t.mapControls.toggleHover=function(n){t.mapControls.isHovered=n};var a=n.retrieve("railLinesLowDetail"),r=a.topoJSON("railnetwork_cleaned").geoJSON(),o=n.retrieve("roads"),s=o.topoJSON("HWY2013_simplified").geoJSON(),l=n.retrieve("crossing"),c=l.topoJSON("motoristdelay_atgradecrossings_omitbarringtoneje_201502_cleaned").geoJSON(),p=n.retrieve("LakeMichigan"),d=p.topoJSON("lake-michigan").geoJSON(),u={"243177N":{ImprovedName:"Morgan St near W 40th St"},"289809Y":{ImprovedName:"Pulaski Rd near W 33rd St"},"843806F":{ImprovedName:"Archer Ave near S Knox Ave"},"843807M":{ImprovedName:"W 55th St near S Kolmar Ave"},"326917X":{ImprovedName:"W 55th St near S Parkside Ave"},"163422T":{ImprovedName:"119th St near Maple Ave"},"326851A":{ImprovedName:"E 47th St near East Ave"},"243205P":{ImprovedName:"S Racine Ave near Pershing Rd"},"869201U":{ImprovedName:"S Muskegon Ave near E 104th St"},"326918E":{ImprovedName:"S Central Ave near W 54th St"}},g={projection:{center:[-88.08889,41.877537],zoom:24e3,offset:{x:-150,y:0}},mapping:{minTotalHour:9999999999,maxTotalHour:-9999999999,minCircleR:4,maxCircleR:40}},h={innerSize:3,outerSize:5,outerLineWidth:1,outerDefOpac:.25,outerHovOpac:.75},m="#FF514F";t.options=[],t.highlightCSS=0,t.highlightContent="";var v=angular.element(e),f=function(n,e,a){function o(t){var n=.2,e=1,i=[g.projection.offset.x>0?-g.projection.offset.x:Math.abs(g.projection.offset.x),g.projection.offset.y>0?-g.projection.offset.y:Math.abs(g.projection.offset.y)],a=S.scaleExtent(),r=S.translate(),o=[],s=[],c={x:r[0],y:r[1],k:S.scale()};e="zoom_in"===t?S.scale()*(1+1*n):S.scale()*(1+-1*n),e<a[0]?e=a[0]:e>a[1]&&(e=a[1]),o=[(i[0]-c.x)/c.k,(i[1]-c.y)/c.k],c.k=e,s=[o[0]*c.k+c.x,o[1]*c.k+c.y],c.x+=i[0]-s[0],c.y+=i[1]-s[1],S.scale(c.k),S.translate([c.x,c.y]),l()}function l(){$=S.scale(),D=S.translate(),D[0]<-(A*$)/2?(D[0]=-(A*$)/2,S.translate(D)):D[0]>A*$/2&&(D[0]=A*$/2,S.translate(D)),D[1]<-(z*$)/2?(D[1]=-(z*$)/2,S.translate(D)):D[1]>z*$/2&&(D[1]=z*$/2,S.translate(D)),N.attr("transform","translate("+D+")scale("+$+")"),O!==$&&w(),O=$,H=!0}function p(){B.selectAll(".lake").data(d.features).enter().append("path").attr("class","lake").attr("d",function(t){return V(t)}).style("fill","url(#lakePatternCrossings)"),W.selectAll(".rail").data(r.features).enter().append("path").attr("class","rail").attr("d",function(t){return V(t)}).style("stroke-width",1/$),U.selectAll(".road").data(s.features).enter().append("path").attr("class","road").attr("d",function(t){return V(t)}).style("stroke-width",1/$);var n=G.selectAll(".crossing").data(c.features,function(t){return t.properties.CROSSING}).enter().append("g").attr("class","crossing").attr("id",function(t){return"cid"+t.properties.CROSSING}).attr("transform",function(n){n.properties.Total_Hour>g.mapping.maxTotalHour&&(g.mapping.maxTotalHour=n.properties.Total_Hour),n.properties.Total_Hour<g.mapping.minTotalHour&&(g.mapping.minTotalHour=n.properties.Total_Hour),n.properties.Rank_2011<=10&&(n.properties.ImprovedName=u[n.properties.CROSSING].ImprovedName,t.options.push(n.properties),t.options.sort(k));var e=C(n.geometry.coordinates);return"translate("+e.x+","+e.y+")"});n.append("circle").attr("class","outer-circle").attr("r",h.outerSize/$).style("fill","white").style("stroke",m),n.append("circle").attr("class","inner-circle").attr("r",h.innerSize/$),n.on("mouseover",function(n){if(q!==n.properties.CROSSING&&!H){var e=0;q=n.properties.CROSSING,f(),E=d3.select(this)[0][0],E.parentNode.appendChild(E),P=d3.select(this);var i=C(n.geometry.coordinates);i.x=i.x*$+D[0]+(A/2+g.projection.offset.x),i.y=i.y*$+D[1]+(z/2+g.projection.offset.y),L?(P.select(".outer-circle").transition().style("opacity",h.outerHovOpac),e=Z(n.properties.Total_Hour)/$):(P.select(".inner-circle").transition().duration(400).attr("r",function(){return h.outerSize/$}),e=0),t.setHighlight(!0,i,n.properties,e)}}),G.selectAll(".crossing").sort(_),y(),F.on("click",function(){q=-1,t.currentSelectedCrossing=-1,f(),y()}).on("mouseover",function(){q=-1,t.currentSelectedCrossing=-1,f()})}function f(){"undefined"!=typeof E&&(L?P.select(".outer-circle").transition().style("opacity",h.outerDefOpac):P.select(".inner-circle").transition().duration(400).attr("r",function(){return h.innerSize/$})),t.setHighlight(!1,0,"",0)}function _(t,n){return t.properties.Total_Hour>n.properties.Total_Hour?-1:t.properties.Total_Hour<n.properties.Total_Hour?1:0}function y(){if(Z.domain([g.mapping.minTotalHour,g.mapping.maxTotalHour]).range([g.mapping.minCircleR,g.mapping.maxCircleR]),G.selectAll(".outer-circle").transition().duration(400).attr("r",function(t){return L?Z(t.properties.Total_Hour)/$:h.outerSize/$}).style("fill",function(){return L?m:"white"}).style("stroke-width",h.outerLineWidth/$).style("opacity",function(){return L?h.outerDefOpac:1}),G.selectAll(".outer-circle").style("stroke",function(){return L?"none":m}),G.selectAll(".inner-circle").attr("r",function(){return h.innerSize/$}),-1!==q){var n=0;f(),P=G.select("#cid"+q),E=P[0][0],E.parentNode.appendChild(E);var e=C(P[0][0].__data__.geometry.coordinates);e.x=e.x*$+D[0]+(A/2+g.projection.offset.x),e.y=e.y*$+D[1]+(z/2+g.projection.offset.y),L?(P.select(".outer-circle").transition().duration(400).style("opacity",h.outerHovOpac),n=Z(P[0][0].__data__.properties.Total_Hour)/$):(P.select(".inner-circle").transition().duration(400).attr("r",h.outerSize/$),n=0),t.setHighlight(!0,e,P[0][0].__data__.properties,n)}}function b(t,n){(t!==M||n!==j)&&(t>1024?x(t,n):x(1024,n)),M=t,j=n}function x(t,n){I.attr("width",t).attr("height",n),R.attr("width",t).attr("height",n).attr("transform",function(){return"translate("+(t/2+g.projection.offset.x)+","+(n/2+g.projection.offset.y)+")"}),F.attr("width",t).attr("height",n).attr("transform",function(){return"translate("+-(t/2+g.projection.offset.x)+","+-(n/2+g.projection.offset.y)+")"}),A=t,z=n}function w(){G.selectAll(".outer-circle").attr("r",function(t){return L?Z(t.properties.Total_Hour)/$:h.outerSize/$}).style("stroke-width",h.outerLineWidth/$),G.selectAll(".inner-circle").attr("r",h.innerSize/$),W.selectAll("path").style("stroke-width",1/$),U.selectAll("path").style("stroke-width",1/$),I.selectAll(".patterns").select("circle").attr("r",1/$)}function C(t){var n=Y(t);return{x:n[0],y:n[1]}}function k(t,n){return t.Rank_2011<n.Rank_2011?-1:t.Rank_2011>n.Rank_2011?1:0}var S=d3.behavior.zoom().translate([0,0]).scale(1).scaleExtent([1,20]).on("zoom",l).on("zoomend",function(){H=!1}),A=e,z=a,T=n+"__d3",M=-1,j=-1,I=d3.select(T).select("svg").attr("width",A).attr("height",z).call(S).on("dblclick.zoom",null).on("mousewheel.zoom",null).on("DOMMouseScroll.zoom",null).on("wheel.zoom",null),R=I.append("g").attr("class","center").attr("width",A).attr("height",z).attr("transform",function(){return"translate("+(A/2+g.projection.offset.x)+","+(z/2+g.projection.offset.y)+")"}),N=R.append("g").attr("class","world_d3").attr("width",A).attr("height",z),L=!1,$=1,O=$,D=[];D[0]=0,D[1]=0;var E,P,H=!1,q=-1,B=N.append("g").attr("class","layer-lake").attr("width",A).attr("height",z),F=N.append("rect").attr("class","layer-deselector").attr("width",A).attr("height",z).attr("transform",function(){return"translate("+-(A/2+g.projection.offset.x)+","+-(z/2+g.projection.offset.y)+")"}),W=N.append("g").attr("class","layer-rails").attr("width",A).attr("height",z),U=N.append("g").attr("class","layer-roads").attr("width",A).attr("height",z),G=N.append("g").attr("class","layer-crossingdelays").attr("width",A).attr("height",z),J=g.projection.zoom/800*z,Y=d3.geo.mercator().scale(J).translate([0,0]).center(g.projection.center),V=d3.geo.path().projection(Y),Z=d3.scale.sqrt();return t.mapControls.setFocus=function(n){q===n&&(n=-1),q=n,t.currentSelectedCrossing=q,y()},t.mapControls.setFullSize=function(){L=L?!1:!0,q=-1,t.currentSelectedCrossing=q,f(),y()},t.setHighlight=function(n,e,a,r){var o=200,s=366;i(function(){n?(s=d3.select(".section.section--white.intro.ng-scope")[0][0].offsetHeight,e.x<o?(t.highlightClass="map-highlight--flip-right",e.x+=r):e.x>A-o?(t.highlightClass="map-highlight--flip-left",e.x-=r):e.y<o+Math.max(v[0].scrollY-s,0)?(t.highlightClass="map-highlight--flip-bottom",e.y+=r):(t.highlightClass="",e.y-=r),t.highlightCSS={left:e.x+"px",top:e.y+"px",visibility:"visible"},t.highlightContent=a):t.highlightCSS={visibility:"hidden"}})},t.mapControls.zoomIn=function(){o("zoom_in"),H=!1},t.mapControls.zoomOut=function(){o("zoom_out"),H=!1},{init:function(){p()},checkWindowSize:function(t,n){b(t,n)}}},_=new f("#crossingdelay",Math.max(v[0].innerWidth,1024),900);_.init();var y=function(){var t=v[0].innerWidth;_.checkWindowSize(t,900)};v.on("resize",y),t.$on("$destroy",function(){v.off("resize",y)}),t.toLining=function(t){return t.replace(/(\d+)/g,'<span class="lining-figure">$1</span>')}}}}]),angular.module("cmapMobilityApp").directive("createprojects",["$q","dataCollection","$window","$timeout",function(t,n,e,i){return{restrict:"E",templateUrl:"components/maps/createprojects/createprojects.tpl.html",link:function(t){t.activeRadio={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0},t.toggleActiveRadio=function(n){t.activeRadio[n]=!t.activeRadio[n]},t.mapControls.toggleContent=!0,t.content={head:[{title:"completed projects (2015)",figure:"23"}]},t.mapControls.toggleHover=function(n){t.mapControls.isHovered=n};var a=n.retrieve("locations"),r=a.topoJSON("create_projects_updated_02").geoJSON(),o=n.retrieve("corridors"),s=o.topoJSON("corridors_poly_01").geoJSON(),l=n.retrieve("mapdata"),c=l.geoJSON();t.controloptions=c.freight.indicators["create-projects"].mapData;var p=n.retrieve("railLinesLowDetail"),d=p.topoJSON("railnetwork_cleaned").geoJSON(),u=n.retrieve("LakeMichigan"),g=u.topoJSON("lake-michigan").geoJSON(),h={projection:{center:[-87.63296,41.893887],zoom:68e3,offset:{x:62,y:-150}}},m={innerSize:2,outerSize:5,outerHoverSize:10,outerLineWidth:1.5,shapes:{P1:{innerSize:1.5,outerSize:9},P2:{innerSize:3,outerSize:9},P3:{innerSize:5.4,outerSize:9},CP:{innerSize:7,outerSize:9},GS:{innerSize:6,outerSize:12},RL:{innerSize:8,outerSize:14}}},v={P1:!0,P2:!0,P3:!0,CP:!0,GS:!0,RL:!0};t.options=[],t.highlightCSS=0,t.highlightContent="";var f=angular.element(e),_=function(n,e,a){function o(t){var n=.2,e=1,i=[h.projection.offset.x>0?-h.projection.offset.x:Math.abs(h.projection.offset.x),h.projection.offset.y>0?-h.projection.offset.y:Math.abs(h.projection.offset.y)],a=w.scaleExtent(),r=w.translate(),o=[],s=[],c={x:r[0],y:r[1],k:w.scale()};e="zoom_in"===t?w.scale()*(1+1*n):w.scale()*(1+-1*n),e<a[0]?e=a[0]:e>a[1]&&(e=a[1]),o=[(i[0]-c.x)/c.k,(i[1]-c.y)/c.k],c.k=e,s=[o[0]*c.k+c.x,o[1]*c.k+c.y],c.x+=i[0]-s[0],c.y+=i[1]-s[1],w.scale(c.k),w.translate([c.x,c.y]),l()}function l(){T=w.scale(),j=w.translate(),j[0]<-(C*T)/2?(j[0]=-(C*T)/2,w.translate(j)):j[0]>C*T/2&&(j[0]=C*T/2,w.translate(j)),j[1]<-(k*T)/2?(j[1]=-(k*T)/2,w.translate(j)):j[1]>k*T/2&&(j[1]=k*T/2,w.translate(j)),L.attr("transform","translate("+j+")scale("+T+")"),M!==T&&b(),M=T,I=!0}function c(){O.selectAll(".lake").data(g.features).enter().append("path").attr("class","lake").attr("d",function(t){return F(t)}).style("fill","url(#lakePatternCreate)"),D.selectAll(".reference").data(d.features).enter().append("path").attr("class","reference").attr("d",function(t){return F(t)}).style("stroke-width",1/T),P.selectAll(".corridor").data(s.features).enter().append("path").attr("class",function(t){return"corridor corridorID_0"+t.properties.id}).attr("d",function(n){return t.options.push(n.properties),F(n)}).style("opacity",.5);var n=H.selectAll(".createproject").data(r.features.filter(function(t){return"P1"===t.properties.CAT||"P2"===t.properties.CAT||"P3"===t.properties.CAT||"CP"===t.properties.CAT
}),function(t){return t.properties.ID}).enter().append("g").attr("class",function(t){return"createproject "+t.properties.CAT});n.attr("transform",function(t){var n=x(t.geometry.coordinates);return"translate("+n.x+","+n.y+")"}).on("mouseover",function(n){if(!I){var e=x(n.geometry.coordinates),i=n.properties.CAT;e.x=e.x*T+j[0]+(C/2+h.projection.offset.x),e.y=e.y*T+j[1]+(k/2+h.projection.offset.y),v[i]&&t.setHighlight(!0,e,n.properties),d3.select(this).select(".inner-circle").transition().duration(200).attr("r",function(t){var n=t.properties.CAT;return m.shapes[n].outerSize/T})}}).on("mouseleave",function(){I||(t.setHighlight(!1,0,""),d3.select(this).select(".inner-circle").transition().duration(200).attr("r",function(t){var n=t.properties.CAT;return m.shapes[n].innerSize/T}))}),n.append("circle").attr("class","outer-circle").attr("r",function(t){var n=t.properties.CAT;return m.shapes[n].outerSize/T}).style("stroke-width",m.outerLineWidth/T),n.append("circle").attr("class","inner-circle").attr("r",function(t){var n=t.properties.CAT;return m.shapes[n].innerSize/T}),n=H.selectAll(".createproject").data(r.features.filter(function(t){return"GS"===t.properties.CAT}),function(t){return t.properties.ID}).enter().append("g").attr("class",function(t){return"createproject "+t.properties.CAT}),n.attr("transform",function(t){var n=x(t.geometry.coordinates);return"translate("+n.x+","+n.y+")"}).on("mouseover",function(n){if(!I){var e=x(n.geometry.coordinates),i=n.properties.CAT;e.x=e.x*T+j[0]+(C/2+h.projection.offset.x),e.y=e.y*T+j[1]+(k/2+h.projection.offset.y),v[i]&&t.setHighlight(!0,e,n.properties),d3.select(this).select(".inner-triangle").transition().duration(200).attr("d",d3.svg.symbol().type("triangle-up").size(function(t){var n=t.properties.CAT;return m.shapes[n].outerSize/T*(m.shapes[n].outerSize/T)})).attr("transform",function(){return"translate(0,0)"})}}).on("mouseleave",function(){I||(t.setHighlight(!1,0,""),d3.select(this).select(".inner-triangle").transition().duration(200).attr("d",d3.svg.symbol().type("triangle-up").size(function(t){var n=t.properties.CAT;return m.shapes[n].innerSize/T*(m.shapes[n].innerSize/T)})).attr("transform",function(t){var n=t.properties.CAT,e=(m.shapes[n].outerSize/T-m.shapes[n].innerSize/T)/4;return"translate(0,"+e+")"}))}),n.append("path").attr("class","outer-triangle").attr("d",d3.svg.symbol().type("triangle-up").size(function(t){var n=t.properties.CAT;return m.shapes[n].outerSize/T*(m.shapes[n].outerSize/T)})).style("stroke-width",m.outerLineWidth/T),n.append("path").attr("class","inner-triangle").attr("d",d3.svg.symbol().type("triangle-up").size(function(t){var n=t.properties.CAT;return m.shapes[n].innerSize/T*(m.shapes[n].innerSize/T)})).attr("transform",function(t){var n=t.properties.CAT,e=(m.shapes[n].outerSize/T-m.shapes[n].innerSize/T)/4;return"translate(0,"+e+")"}),n=H.selectAll(".createproject").data(r.features.filter(function(t){return"RL"===t.properties.CAT}),function(t){return t.properties.ID}).enter().append("g").attr("class",function(t){return"createproject "+t.properties.CAT}),n.attr("transform",function(t){var n=x(t.geometry.coordinates),e=t.properties.CAT;return"translate("+n.x+","+(n.y-Math.sqrt(Math.pow(m.shapes[e].outerSize,2)/2))+")rotate(45)"}).on("mouseover",function(n){if(!I){var e=n.properties.CAT,i=x(n.geometry.coordinates);i.x=i.x*T+j[0]+(C/2+h.projection.offset.x),i.y=i.y*T+j[1]+(k/2+h.projection.offset.y),v[e]&&t.setHighlight(!0,i,n.properties),d3.select(this).select(".inner-diamond").transition().duration(200).attr("width",function(t){var n=t.properties.CAT;return m.shapes[n].outerSize/T}).attr("height",function(t){var n=t.properties.CAT;return m.shapes[n].outerSize/T}).attr("transform",function(){return"translate(0,0)"})}}).on("mouseleave",function(){I||(t.setHighlight(!1,0,""),d3.select(this).select(".inner-diamond").transition().duration(200).attr("width",function(t){var n=t.properties.CAT;return m.shapes[n].innerSize/T}).attr("height",function(t){var n=t.properties.CAT;return m.shapes[n].innerSize/T}).attr("transform",function(t){var n=t.properties.CAT;return"translate("+(m.shapes[n].outerSize/T-m.shapes[n].innerSize/T)/2+","+(m.shapes[n].outerSize/T-m.shapes[n].innerSize/T)/2+")"}))}),n.append("rect").attr("class","outer-diamond").attr("width",function(t){var n=t.properties.CAT;return m.shapes[n].outerSize/T}).attr("height",function(t){var n=t.properties.CAT;return m.shapes[n].outerSize/T}).style("stroke-width",m.outerLineWidth/T),n.append("rect").attr("class","inner-diamond").attr("width",function(t){var n=t.properties.CAT;return m.shapes[n].innerSize/T}).attr("height",function(t){var n=t.properties.CAT;return m.shapes[n].innerSize/T}).attr("transform",function(t){var n=t.properties.CAT;return"translate("+(m.shapes[n].outerSize-m.shapes[n].innerSize)/2+","+(m.shapes[n].outerSize-m.shapes[n].innerSize)/2+")"}).style("stroke-width",m.outerLineWidth/T),E.on("mouseover",function(){t.setHighlight(!1,0,"")}).on("click",function(){t.setHighlight(!1,0,"")})}function p(){H.selectAll(".createproject").transition().duration(400).style("opacity",function(t){var n=t.properties.CAT;return v[n]?1:0}).style("pointer-events",function(t){var n=t.properties.CAT;return v[n]?"all":"none"})}function u(){P.selectAll(".corridor").transition().duration(200).style("opacity",function(t){return $===t.properties.id?1:.5})}function _(t,n){(t!==A||n!==z)&&(t>1024?y(t,n):y(1024,n)),A=t,z=n}function y(t,n){R.attr("width",t).attr("height",n),N.attr("transform",function(){return"translate("+(t/2+h.projection.offset.x)+","+(n/2+h.projection.offset.y)+")"}),E.attr("width",t).attr("height",n).attr("transform",function(){return"translate("+-(t/2+h.projection.offset.x)+","+-(n/2+h.projection.offset.y)+")"}),C=t,k=n}function b(){var t=H.selectAll(".createproject");t.select(".outer-circle").attr("r",function(t){var n=t.properties.CAT;return m.shapes[n].outerSize/T}).style("stroke-width",m.outerLineWidth/T),t.select(".inner-circle").attr("r",function(t){var n=t.properties.CAT;return m.shapes[n].innerSize/T}),t.select(".outer-triangle").attr("d",d3.svg.symbol().type("triangle-up").size(function(t){var n=t.properties.CAT;return m.shapes[n].outerSize/T*(m.shapes[n].outerSize/T)})).style("stroke-width",m.outerLineWidth/T),t.select(".inner-triangle").attr("d",d3.svg.symbol().type("triangle-up").size(function(t){var n=t.properties.CAT;return m.shapes[n].innerSize/T*(m.shapes[n].innerSize/T)})).attr("transform",function(t){var n=t.properties.CAT,e=(m.shapes[n].outerSize/T-m.shapes[n].innerSize/T)/4;return"translate(0,"+e+")"}),t.select(".outer-diamond").attr("width",function(t){var n=t.properties.CAT;return m.shapes[n].outerSize/T}).attr("height",function(t){var n=t.properties.CAT;return m.shapes[n].outerSize/T}).style("stroke-width",m.outerLineWidth/T),t.select(".inner-diamond").attr("width",function(t){var n=t.properties.CAT;return m.shapes[n].innerSize/T}).attr("height",function(t){var n=t.properties.CAT;return m.shapes[n].innerSize/T}).attr("transform",function(t){var n=t.properties.CAT;return"translate("+(m.shapes[n].outerSize/T-m.shapes[n].innerSize/T)/2+","+(m.shapes[n].outerSize/T-m.shapes[n].innerSize/T)/2+")"}).style("stroke-width",m.outerLineWidth/T),D.selectAll("path").style("stroke-width",1/T),R.selectAll(".patterns").select("circle").attr("r",1/T)}function x(t){var n=B(t);return{x:n[0],y:n[1]}}var w=d3.behavior.zoom().translate([0,0]).scale(1).scaleExtent([1,20]).on("zoom",l).on("zoomend",function(){I=!1}),C=e,k=a,S=n+"__d3",A=-1,z=-1,T=1,M=T,j=[];j[0]=0,j[1]=0;var I=!1,R=d3.select(S).select("svg").attr("width",C).attr("height",k).call(w).on("dblclick.zoom",null).on("mousewheel.zoom",null).on("DOMMouseScroll.zoom",null).on("wheel.zoom",null),N=R.append("g").attr("class","center").attr("width",C).attr("height",k).attr("transform",function(){return"translate("+(C/2+h.projection.offset.x)+","+(k/2+h.projection.offset.y)+")"}),L=N.append("g").attr("class","world_d3").attr("width",C).attr("height",k),$=-1,O=L.append("g").attr("class","layer-lake").attr("width",C).attr("height",k),D=L.append("g").attr("class","layer-reference").attr("width",C).attr("height",k),E=L.append("rect").attr("class","layer-deselector").attr("width",C).attr("height",k).attr("transform",function(){return"translate("+-(C/2+h.projection.offset.x)+","+-(k/2+h.projection.offset.y)+")"}),P=L.append("g").attr("class","layer-corridors").attr("width",C).attr("height",k),H=L.append("g").attr("class","layer-createprojects").attr("width",C).attr("height",k),q=h.projection.zoom/800*k,B=d3.geo.mercator().scale(q).translate([0,0]).center(h.projection.center),F=d3.geo.path().projection(B);return t.setHighlight=function(n,e,a){var r=270,o=398;i(function(){n?(o=d3.select(".section.section--white.intro.ng-scope")[0][0].offsetHeight,t.highlightClass=e.x<r?"map-highlight--flip-right":e.x>C-r?"map-highlight--flip-left":e.y<r+Math.max(f[0].scrollY-o,0)?"map-highlight--flip-bottom":"",t.highlightCSS={left:e.x+"px",top:e.y+"px",visibility:"visible"},t.highlightContent=a):t.highlightCSS={visibility:"hidden"}})},t.mapControls.toggleProjects=function(t){v[t]=v[t]?!1:!0,p()},t.mapControls.zoomIn=function(){o("zoom_in"),I=!1},t.mapControls.zoomOut=function(){o("zoom_out"),I=!1},t.mapControls.highLightCorridor=function(t){$=t,u()},{init:function(){c()},checkWindowSize:function(t,n){_(t,n)}}},y=new _("#createprojects",Math.max(f[0].innerWidth,1024),900);y.init();var b=function(){var t=f[0].innerWidth;y.checkWindowSize(t,900)};f.on("resize",b),t.$on("$destroy",function(){f.off("resize",b)}),t.toLining=function(t){return t.replace(/(\d+)/g,'<span class="lining-figure">$1</span>')}}}}]),angular.module("cmapMobilityApp").directive("bridgeCondition",["$q","dataCollection","$window","$timeout",function(t,n,e,i){return{restrict:"E",templateUrl:"components/maps/bridge-condition/bridge-condition.tpl.html",link:function(t){t.activeRadio={radio1:!0,radio2:!0},t.toggleActiveRadio=function(n){t.activeRadio[n]=!t.activeRadio[n]},t.mapControls.toggleContent=!0,t.content={head:[{title:"total bridges, 2013",figure:"3,438"},{title:"structurally deficient bridges, 2013",figure:"302"}],timeline:{title:"Bridges built by year"},toggler:{title:"Click to toggle visibility by bridge condition"}};var a=n.retrieve("bridges"),r=a.topoJSON("NationalBridgeInventory_illinois_2013_updated").geoJSON(),o=n.retrieve("bq-timeline"),s=o.geoJSON(),l=n.retrieve("roads"),c=l.topoJSON("HWY2013_simplified").geoJSON(),p=n.retrieve("LakeMichigan"),d=p.topoJSON("lake-michigan").geoJSON(),u={projection:{center:[-88.08889,41.877537],zoom:23e3,offset:{x:-135,y:10}}},g={innerSize:3,outerSize:5,outerHoverSize:10,outerLineWidth:1};t.options=[],t.highlightCSS=0,t.highlightContent="";var h=!0,m=!0,v=0,f=1;t.selectedOption=s;var _=angular.element(e),y=function(n,e,a){function o(t){var n=.2,e=1,i=[u.projection.offset.x>0?-u.projection.offset.x:Math.abs(u.projection.offset.x),u.projection.offset.y>0?-u.projection.offset.y:Math.abs(u.projection.offset.y)],a=S.scaleExtent(),r=S.translate(),o=[],l=[],c={x:r[0],y:r[1],k:S.scale()};e="zoom_in"===t?S.scale()*(1+1*n):S.scale()*(1+-1*n),e<a[0]?e=a[0]:e>a[1]&&(e=a[1]),o=[(i[0]-c.x)/c.k,(i[1]-c.y)/c.k],c.k=e,l=[o[0]*c.k+c.x,o[1]*c.k+c.y],c.x+=i[0]-l[0],c.y+=i[1]-l[1],S.scale(c.k),S.translate([c.x,c.y]),s()}function s(){I=S.scale(),N=S.translate(),N[0]<-(A*I)/2?(N[0]=-(A*I)/2,S.translate(N)):N[0]>A*I/2&&(N[0]=A*I/2,S.translate(N)),N[1]<-(z*I)/2?(N[1]=-(z*I)/2,S.translate(N)):N[1]>z*I/2&&(N[1]=z*I/2,S.translate(N)),H.attr("transform","translate("+N+")scale("+I+")"),R!==I&&w(),R=I,O=!0}function l(){q.selectAll(".lake").data(d.features).enter().append("path").attr("class","lake").attr("d",function(t){return J(t)}).style("fill","url(#lakePatternBridge)"),B.selectAll(".reference").data(c.features).enter().append("path").attr("class","reference").attr("d",function(t){return J(t)}).style("stroke-width",1/I),y()}function p(){"undefined"!=typeof L&&(t.setHighlight(!1,0,""),$.select(".inner-circle").transition().duration(400).attr("r",function(){return g.innerSize/I}))}function y(){v=h?0:-1,f=m?1:-1;var n=W.selectAll(".bridges").data(r.features.filter(function(n){return Math.max(n.properties.YEAR_BUILT,n.properties.YEAR_RECON)<=t.currentyear&&(v===n.properties.STATUS_NO_||f===n.properties.STATUS_NO_)}),function(t){return t.properties.SNKey}),e=n.enter().append("g").attr("class","bridges").attr("transform",function(t){var n=k(t.geometry.coordinates);return"translate("+n.x+","+n.y+")"}).style("pointer-events","visible");n.exit().remove(),e.append("circle").attr("class","outer-circle"),W.selectAll(".outer-circle").attr("r",g.outerSize/I).style("stroke-width",g.outerLineWidth/I).style("stroke",function(n){return 1===n.properties.STATUS_NO_&&t.currentyear>=2013?"rgba("+Y+",1)":"rgba("+V+",1)"}),e.append("circle").attr("class","inner-circle"),W.selectAll(".inner-circle").attr("r",g.innerSize/I).style("fill","white").style("fill",function(n){return 1===n.properties.STATUS_NO_&&t.currentyear>=2013?"rgba("+Y+",1)":"rgba("+V+",1)"}),e.on("mouseover",function(n){if(D!==n.properties.SNKey&&!O){D=n.properties.SNKey,p(),L=d3.select(this)[0][0],L.parentNode.appendChild(L),$=d3.select(this);var e=k(n.geometry.coordinates);e.x=e.x*I+N[0]+(A/2+u.projection.offset.x),e.y=e.y*I+N[1]+(z/2+u.projection.offset.y),t.setHighlight(!0,e,n.properties),$.select(".inner-circle").transition().duration(400).attr("r",function(){return g.outerSize/I})}}),W.selectAll(".bridges").sort(C),F.on("click",function(){p(),D=-1}).on("mouseover",function(){p(),D=-1})}function b(t,n){(t!==M||n!==j)&&(t>1024?x(t,n):x(1024,n)),M=t,j=n}function x(t,n){E.attr("width",t).attr("height",n),P.attr("transform",function(){return"translate("+(t/2+u.projection.offset.x)+","+(n/2+u.projection.offset.y)+")"}),F.attr("width",t).attr("height",n).attr("transform",function(){return"translate("+-(t/2+u.projection.offset.x)+","+-(n/2+u.projection.offset.y)+")"}),A=t,z=n}function w(){var t=W.selectAll(".bridges");t.select(".outer-circle").attr("r",function(){return g.outerSize/I}).style("stroke-width",function(){return g.outerLineWidth/I}),t.select(".inner-circle").attr("r",function(){return g.innerSize/I}),B.selectAll("path").style("stroke-width",1/I),E.selectAll(".patterns").select("circle").attr("r",1/I)}function C(t,n){return t.properties.STATUS_NO_<n.properties.STATUS_NO_?-1:t.properties.STATUS_NO_>n.properties.STATUS_NO_?1:0}function k(t){var n=G(t);return{x:n[0],y:n[1]}}var S=d3.behavior.zoom().translate([0,0]).scale(1).scaleExtent([1,20]).on("zoom",s).on("zoomend",function(){O=!1}),A=e,z=a,T=n+"__d3",M=-1,j=-1,I=1,R=I,N=[];N[0]=0,N[1]=0;var L,$,O=!1,D=-1,E=d3.select(T).select("svg").attr("width",A).attr("height",z).call(S).on("dblclick.zoom",null).on("mousewheel.zoom",null).on("DOMMouseScroll.zoom",null).on("wheel.zoom",null),P=E.append("g").attr("class","center").attr("width",A).attr("height",z).attr("transform",function(){return"translate("+(A/2+u.projection.offset.x)+","+(z/2+u.projection.offset.y)+")"}),H=P.append("g").attr("class","world_d3").attr("width",A).attr("height",z),q=H.append("g").attr("class","layer-lake").attr("width",A).attr("height",z),B=H.append("g").attr("class","layer-reference").attr("width",A).attr("height",z),F=H.append("rect").attr("class","layer-deselector").attr("width",A).attr("height",z).attr("transform",function(){return"translate("+-(A/2+u.projection.offset.x)+","+-(z/2+u.projection.offset.y)+")"}),W=H.append("g").attr("class","layer-bridgesquality").attr("width",A).attr("height",z),U=u.projection.zoom/800*z,G=d3.geo.mercator().scale(U).translate([0,0]).center(u.projection.center),J=d3.geo.path().projection(G),Y="244,195,30",V="0,189,204";return t.setTimeFrame=function(){t.currentyear<2013?(m=!0,h=!0):(t.activeRadio.radio1=!0,t.activeRadio.radio2=!0),y()},t.setHighlight=function(n,e,a){var r=110,o=155,s=462;i(function(){n?(s=d3.select(".section.section--white.intro.ng-scope")[0][0].offsetHeight,t.highlightClass=e.x<r?"map-highlight--flip-right":e.x>A-r?"map-highlight--flip-left":e.y<o+Math.max(_[0].scrollY-s,0)?"map-highlight--flip-bottom":"",t.highlightCSS={left:e.x+"px",top:e.y+"px",visibility:"visible"},t.highlightContent=a):t.highlightCSS={visibility:"hidden"}})},t.mapControls.showProper=function(){t.currentyear>=2013&&(h=h?!1:!0,y())},t.mapControls.showDeficient=function(){t.currentyear>=2013&&(m=m?!1:!0,y())},t.mapControls.zoomIn=function(){o("zoom_in"),O=!1},t.mapControls.zoomOut=function(){o("zoom_out"),O=!1},d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},{init:function(){l()},checkWindowSize:function(t,n){b(t,n)}}},b=new y("#bridgesquality",Math.max(_[0].innerWidth,1024),900);b.init();var x=function(){var t=_[0].innerWidth;b.checkWindowSize(t,900)};_.on("resize",x),t.$on("$destroy",function(){_.off("resize",x)}),t.$watch(function(){return t.currentyear},function(n){"undefined"!=typeof n&&t.setTimeFrame()})}}}]),angular.module("cmapMobilityApp").directive("ridequality",["$q","dataCollection","$window",function(t,n,e){return{restrict:"E",templateUrl:"components/maps/ridequality/ridequality.tpl.html",link:function(t){t.toggleContent=!0,t.content={head:{title:"Select one of the map layers"},timeline:{title:"Select a year"}},t.mapControls.toggleHover=function(n){t.mapControls.isHovered=n};var i=function(n){t.mapControls.isSelected=n},a=n.retrieve("mapdata"),r=a.geoJSON(),o=n.retrieve("separated-counties"),s=o.topoJSON("7cnty_boundary").geoJSON(),l=n.retrieve("dotted-counties"),c=l.geoJSON(),p={projection:{center:[-88.08889,41.877537],zoom:22e3,offset:{x:0,y:0},offsetCounties:{x:-1,y:0}},mapping:{minCurrentSelected:9999999999,maxCurrentSelected:-9999999999,minCircleR:1,maxCircleR:5},labels:{padding_leftright:10,padding_topbottom:6,spacing:10,labelsOffset:{Lake:{x:5,y:4},McHenry:{x:1,y:3},Cook:{x:25,y:1},DuPage:{x:3,y:7},Will:{x:15,y:17},Kane:{x:-1,y:-4},Kendall:{x:12,y:-4}}}},d=r.roads.indicators["ride-quality"].mapData.overall;t.countydata=r.roads.indicators["ride-quality"].mapData.byCounty,t.options=[];for(var u in d)t.options.push(d[u]);t.options.sort(function(t,n){return t.key>n.key}),t.selectedOption=t.options[0],t.currentMode=t.selectedOption["selection-name"],t.currentColor=t.options[0].color;var g=angular.element(e),h=function(n,e,a){function r(){b.selectAll(".county").data(s.features).enter().append("path").attr("class","county").attr("d",function(t){return k(t)}).attr("transform",function(){return"translate("+p.projection.offsetCounties.x+","+p.projection.offsetCounties.y+")"}),x.selectAll(".dot").data(c).enter().append("circle").attr("class",function(t){return"dot "+t.type}).attr("transform",function(t){var n=g([t.lon,t.lat]);return"translate("+n.x+","+n.y+")"}).attr("r",0).transition().duration(500).attr("r",p.mapping.minCircleR);var n=w.selectAll(".label").data(s.features).enter().append("g").attr("class",function(t){return"label "+t.properties.CNTYNAME});n.append("rect").attr("class","background-box"),n.append("text").attr("class","county-name").attr("text-anchor","start").text(function(t){return t.properties.CNTYNAME.toUpperCase()}),n.select(".county-name").each(function(t){t.cn_height=this.getBBox().height,t.cn_width=this.getBBox().width}),n.append("text").attr("class","county-value").attr("text-anchor","start").text(function(){return"100%"}).attr("transform",function(t){var n=t.cn_width+p.labels.spacing,e=0;return"translate("+n+","+e+")"}),n.select(".county-value").each(function(t){t.cv_height=this.getBBox().height,t.cv_width=this.getBBox().width}),n.select(".background-box").attr("width",function(t){return t.cv_width+t.cn_width+p.labels.spacing+2*p.labels.padding_leftright}).attr("height",function(t){return t.cv_height+2*p.labels.padding_topbottom}).attr("transform",function(t){var n=-p.labels.padding_leftright,e=-(t.cv_height/3*2+p.labels.padding_topbottom+1);return"translate("+n+","+e+")"}),n.attr("transform",function(t){var n=(t.cv_width+t.cn_width+p.labels.padding_leftright)/2,e=(t.cv_height/2+p.labels.padding_topbottom)/2,i=p.labels.labelsOffset[t.properties.CNTYNAME],a=k.centroid(t),r=i.x+a[0]-n,o=i.y+a[1]-e;return"translate("+r+","+o+")"}),t.mapControls.setMode(t.selectedOption)}function o(t){var n=0;return n="BLoS"===t||"PLoS"===t?5.2:1,{min:0,max:n}}function l(){S.domain([p.mapping.minCurrentSelected,p.mapping.maxCurrentSelected]).range([p.mapping.minCircleR,p.mapping.maxCircleR]),x.selectAll(".dot").transition().duration(350).attr("r",function(n){var e=t.countydata[n.type][t.currentMode][t.currentyear];return(null===e||0===e)&&(e=p.mapping.minCurrentSelected),Math.round(S(e))}).style("fill",function(n){var e=t.countydata[n.type][t.currentMode][t.currentyear];return null===e?T:t.currentColor}),w.selectAll(".county-value").text(function(n){var e=t.countydata[n.properties.CNTYNAME][t.currentMode][t.currentyear];return null===e?"N/A":1>=e?Math.ceil(100*e)+"%":e}).attr("transform",function(t){var n=t.cn_width+p.labels.spacing,e=0;return"translate("+n+","+e+")"}),w.selectAll(".county-value").each(function(t){t.cv_height=this.getBBox().height,t.cv_width=this.getBBox().width}),w.selectAll(".background-box").attr("width",function(t){return t.cv_width+t.cn_width+p.labels.spacing+2*p.labels.padding_leftright}),w.selectAll(".county-value").transition().duration(400).style("fill",function(n){var e=t.countydata[n.properties.CNTYNAME][t.currentMode][t.currentyear];return null===e?T:t.currentColor}).text(function(n){var e=t.countydata[n.properties.CNTYNAME][t.currentMode][t.currentyear];return null===e?"N/A":1>=e?Math.ceil(100*e)+"%":e})}function d(t,n){(t!==A||n!==z)&&(t>1024?u(t,n):u(1024,n)),A=t,z=n}function u(t,n){f.attr("width",t).attr("height",n),_.attr("transform",function(){return"translate("+(t/2+p.projection.offset.x)+","+(n/2+p.projection.offset.y)+")"}),y.attr("width",t).attr("height",n),h=t,m=n}function g(t){var n=C(t);return{x:Math.round(n[0]),y:Math.round(n[1])}}var h=e,m=a,v=n+"__d3",f=d3.select(v).append("svg").attr("width",h).attr("height",m),_=f.append("g").attr("class","center").attr("width",h).attr("height",m).attr("transform",function(){return"translate("+(h/2+p.projection.offset.x)+","+(m/2+p.projection.offset.y)+")"}),y=_.append("g").attr("class","world_d3").attr("width",h).attr("height",m),b=y.append("g").attr("class","layer-counties").attr("width",h).attr("height",m),x=y.append("g").attr("class","layer-grid").attr("width",h).attr("height",m),w=y.append("g").attr("class","layer-labels").attr("width",h).attr("height",m),C=d3.geo.mercator().scale(p.projection.zoom).translate([0,0]).center(p.projection.center),k=d3.geo.path().projection(C),S=d3.scale.sqrt(),A=-1,z=-1,T="rgb(80,80,80)";return t.mapControls.setMode=function(n){t.selectedOption=n,t.currentMode=n["selection-name"],t.currentColor=n.color;var e=o(t.currentMode);p.mapping.minCurrentSelected=e.min,p.mapping.maxCurrentSelected=e.max,i(n.name),l()},t.setTimeFrame=function(){var n=o(t.currentMode);p.mapping.minCurrentSelected=n.min,p.mapping.maxCurrentSelected=n.max,l()},{init:function(){r()},checkWindowSize:function(t,n){d(t,n)}}},m=new h("#ridequality",Math.max(g[0].innerWidth,1024),900),v=function(){var t=g[0].innerWidth,n=900;m.checkWindowSize(t,n)};g.on("resize",v),t.$on("$destroy",function(){g.off("resize",v)}),t.$watch(function(){return t.currentyear},function(n,e){"undefined"!=typeof n&&"undefined"==typeof e?m.init():"undefined"!=typeof n&&t.setTimeFrame()})}}}]),angular.module("cmapMobilityApp").directive("timelined3",["$timeout",function(t){return{restrict:"E",templateUrl:"components/maps/timelined3/timelined3.tpl.html",replace:!0,scope:{selectedData:"&",currentyear:"="},link:function(n,e,i){n.highlightCSS=0,n.highlightContent="";var a={paddingLeft:i.paddingleft,paddingRight:i.paddingright,paddingLabels:25,paddingTop:30},r=function(e,r,o){function s(){var e=T.extent()[0];if(d3.event.sourceEvent&&(e=A.invert(d3.mouse(this)[0]),T.extent([e,e])),j.attr("transform","translate("+A(e)+","+y+")"),k.select(".timelinefill").attr("x2",A(e)),h=Math.floor(e),"1"===i.liveupdate&&h!==m){m=h;var a;2===g.ticks?(a=T.extent()[0]>=(g.years[g.years.length-1]-g.years[0])/2+g.years[0]?g.years[g.years.length-1]:g.years[0],u(a),t(function(){n.currentyear=a})):(a=m,t(function(){n.currentyear=a}),u(a))}else"0"===i.liveupdate&&u(h);d()}function l(){T.extent(2===g.ticks?T.extent()[0]>=(g.years[g.years.length-1]-g.years[0])/2+g.years[0]?[g.years[g.years.length-1],0]:[g.years[0],0]:[Math.round(T.extent()[0]),Math.round(T.extent()[0])]);var t=T.extent()[0];j.transition().duration(200).attr("transform","translate("+A(t)+","+y+")"),k.select(".timelinefill").transition().duration(200).attr("x2",A(t)),n.currentyear=Math.floor(t),h=Math.floor(t),u(h),d()}function c(t){g=t.timeline,n.currentyear=g.years[0],A=d3.scale.linear().domain([g.years[0],g.years[g.years.length-1]]).range([a.paddingLeft,v-a.paddingRight]).clamp(!0),T.x(A),M.call(function(){T.extent("end"===g.sliderPosition?[g.years[g.years.length-1],g.years[g.years.length-1]]:[g.years[0],g.years[0]])}).call(T.event);var e=k.select(".timelineLabels").selectAll(".timelabel").data(g.labels,function(t){return t});e.exit().remove();var i=e.enter().append("g").attr("class","timelabel").attr("transform",function(t){return"translate("+A(t)+","+y+")"});i.append("text").attr("class","timeline-year").text(function(t){return t}).attr("transform",function(){return"translate(0,"+a.paddingLabels+")"}),i.append("circle").attr("class","timeline-circle").attr("r",3),g.values.length>0&&p(g)}function p(t){z.domain([0,t.maxValue]),C.selectAll(".polyGraph").data([t]).enter().append("g").attr("class","polyGraph").append("path").attr("d",function(t){var n="";return n="M"+a.paddingLeft+","+y,t.values.forEach(function(e,i){n=n+"L"+A(t.years[i])+","+z(e)}),n=n+"L"+(v-a.paddingRight)+","+y,n+"Z"})}function d(){k.select(".timelineLabels").selectAll(".timelabel").select("circle").attr("class",function(t){return t<=T.extent()[0]?"filled":""})}function u(t){j.select("text").text(t).attr("transform","translate(0,"+-(y-30)+")")}var g,h,m=0,v=r,f=o,_=e+"__d3",y=f-40,b=10,x=d3.select(_).select("svg").attr("width",v).attr("height",f),w=x.append("g").attr("class","world_d3"),C=w.append("g").attr("class","graphLayer").attr("width",v).attr("height",f),k=w.append("g").attr("class","timelineElementsLayer"),S=w.append("g").attr("class","timelineLayer"),A=d3.scale.linear().range([a.paddingLeft,v-a.paddingRight]).clamp(!0),z=d3.scale.linear().range([y,a.paddingTop]).clamp(!0),T=d3.svg.brush().x(A).extent([0,0]).on("brush",s).on("brushend",function(){t(function(){l()})}),M=S.append("g").attr("class","time-slider").call(T);M.selectAll(".extent,.resize").remove(),M.select(".background").attr("height",f).attr("width",v),k.append("line").attr("class","timelinebg").attr("x1",a.paddingLeft).attr("y1",y).attr("y2",y).attr("x2",v-a.paddingRight),k.append("line").attr("class","timelinefill").attr("x1",a.paddingLeft).attr("y1",y).attr("y2",y).attr("x2",a.paddingLeft),k.append("g").attr("class","timelineLabels");var j=M.append("g").attr("class","timeHandle").attr("transform","translate(0,"+y+")");return j.attr("filter","url(#highlight-drop-shadow-d3)"),j.append("line").attr("x1",35).attr("y1",25).attr("x2",35).attr("y2",y-b).attr("transform","translate(-35,"+-y+")"),j.append("polygon").attr("points","0,0 0,25 36.061,25 39.683,32.021 40.684,32.021 44.306,25 80,25 80,0").attr("transform","translate(-5,2)").attr("transform","translate(-40,"+-(y-2-10)+")"),j.append("text").attr("transform","translate(-35,"+(-y-10)+")"),j.append("circle").attr("r",b),j.append("line").attr("x1",-4).attr("y1",-4).attr("y2",4).attr("x2",-4),j.append("line").attr("x1",0).attr("y1",-4).attr("y2",4).attr("x2",0),j.append("line").attr("x1",4).attr("y1",-4).attr("y2",4).attr("x2",4),{updateData:function(t){c(t)}}},o=new r("#timelined3",i.width,i.height);n.$watch(function(){return n.selectedData()},function(t){"undefined"!=typeof t&&o.updateData(t)})}}}]),angular.module("cmapMobilityApp").directive("mapAccessToTransit",["dataCollection",function(t){return{restrict:"E",templateUrl:"components/maps/access-to-transit/access-to-transit.tpl.html",link:function(n){n.content={head:{title:"Select one of the map layers"}};var e=t.retrieve("mapdata"),i=e.geoJSON();n.options=i.transit.indicators["access-to-transit"].mapData,n.mapControls.layers=[];for(var a=5,r=0;a>r;r++)n.mapControls.layers.push(!1);n.mapControls.layers[0]=!0,n.mapControls.switchLayer=function(t){if(0===t){for(var e=1;e<n.mapControls.layers.length;e++)n.mapControls.layers[e]=!1;n.mapControls.layers[0]=!0}else n.mapControls.layers[0]=!1,n.mapControls.layers[t]=!n.mapControls.layers[t]},n.useLQ=-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0}}}]),angular.module("cmapMobilityFilters",[]).filter("numToTime",function(){return function(t,n){"milliseconds"===n?t=Math.floor(t/1e3):"minutes"===n?t=Math.floor(60*t):"hours"===n&&(t=Math.floor(3600*t));var e=Math.floor(t/3600),i=Math.floor((t-3600*e)/60),a="";return 0!==e?(e=10>e&&0!==e?"0"+e:String(e),a=e+"' "):a="00' ",(0!==i||""!==a)&&(i=10>i&&""!==a?"0"+i:String(i),a+=i+'"'),a}}).filter("hasValue",function(){return function(t){var n;return n="NaN"!==t&&""!==t&&"undefined"!=typeof t?t:"N/A"}});